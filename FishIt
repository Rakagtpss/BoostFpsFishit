local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Player = Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()

-- // --- CONFIGURATION ---
local UI_WIDTH = 300 
local UI_HEIGHT = 250
local THEME = {
    Background = Color3.fromRGB(25, 25, 30),
    Header = Color3.fromRGB(35, 35, 40),
    Button = Color3.fromRGB(45, 45, 50),
    Accent = Color3.fromRGB(0, 255, 170), -- Greenish
    Text = Color3.fromRGB(230, 230, 230),
    Red = Color3.fromRGB(255, 80, 80)
}

-- // State
local AutoTotemActive = false
local SelectedTotemName = "" -- Default kosong
local Optimized = false

-- // Cleanup
if CoreGui:FindFirstChild("SeraphinV6") then CoreGui.SeraphinV6:Destroy() end

-- // --- UI CREATION ---
local Gui = Instance.new("ScreenGui", CoreGui)
Gui.Name = "SeraphinV6"
Gui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", Gui)
MainFrame.Size = UDim2.new(0, UI_WIDTH, 0, UI_HEIGHT)
MainFrame.Position = UDim2.new(0.5, -UI_WIDTH/2, 0.3, 0)
MainFrame.BackgroundColor3 = THEME.Background
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)

-- Header
local Header = Instance.new("Frame", MainFrame)
Header.Size = UDim2.new(1, 0, 0, 40)
Header.BackgroundColor3 = THEME.Header
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(0.8, 0, 1, 0)
Title.Position = UDim2.new(0.05, 0, 0, 0)
Title.Text = "SERAPHIN <b>TOTEM MANAGER</b>"
Title.RichText = true
Title.TextColor3 = THEME.Text
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Close/Min Button
local MinBtn = Instance.new("TextButton", Header)
MinBtn.Size = UDim2.new(0, 25, 0, 25)
MinBtn.Position = UDim2.new(1, -30, 0.5, -12.5)
MinBtn.Text = "X"
MinBtn.BackgroundColor3 = THEME.Red
MinBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0, 6)

-- // --- CONTENT ---
local Container = Instance.new("Frame", MainFrame)
Container.Size = UDim2.new(1, -20, 1, -50)
Container.Position = UDim2.new(0, 10, 0, 45)
Container.BackgroundTransparency = 1

local UIList = Instance.new("UIListLayout", Container)
UIList.Padding = UDim.new(0, 8)
UIList.SortOrder = Enum.SortOrder.LayoutOrder

-- 1. MANUAL INPUT (JAGA-JAGA JIKA SCAN GAGAL)
local InputBox = Instance.new("TextBox", Container)
InputBox.Size = UDim2.new(1, 0, 0, 35)
InputBox.PlaceholderText = "Type Totem Name Here (e.g. Sundial Totem)"
InputBox.Text = ""
InputBox.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
InputBox.TextColor3 = THEME.Accent
InputBox.Font = Enum.Font.GothamBold
InputBox.TextSize = 12
InputBox.LayoutOrder = 1
Instance.new("UICorner", InputBox).CornerRadius = UDim.new(0, 6)

InputBox:GetPropertyChangedSignal("Text"):Connect(function()
    SelectedTotemName = InputBox.Text
end)

-- 2. SCROLL LIST (HASIL SCAN)
local ScrollList = Instance.new("ScrollingFrame", Container)
ScrollList.Size = UDim2.new(1, 0, 0, 80) -- Area List
ScrollList.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
ScrollList.ScrollBarThickness = 2
ScrollList.LayoutOrder = 2
ScrollList.AutomaticCanvasSize = Enum.AutomaticSize.Y
Instance.new("UICorner", ScrollList).CornerRadius = UDim.new(0, 6)
local ScrollLayout = Instance.new("UIListLayout", ScrollList)
ScrollLayout.Padding = UDim.new(0, 2)

-- 3. TOMBOL ACTION
local SpawnOnceBtn = Instance.new("TextButton", Container)
SpawnOnceBtn.Size = UDim2.new(1, 0, 0, 30)
SpawnOnceBtn.Text = "SPAWN ONCE (TEST)"
SpawnOnceBtn.BackgroundColor3 = THEME.Button
SpawnOnceBtn.TextColor3 = THEME.Text
SpawnOnceBtn.Font = Enum.Font.GothamBold
SpawnOnceBtn.TextSize = 11
SpawnOnceBtn.LayoutOrder = 3
Instance.new("UICorner", SpawnOnceBtn).CornerRadius = UDim.new(0, 6)

local AutoToggleBtn = Instance.new("TextButton", Container)
AutoToggleBtn.Size = UDim2.new(1, 0, 0, 30)
AutoToggleBtn.Text = "AUTO EVERY 60M: OFF"
AutoToggleBtn.BackgroundColor3 = THEME.Button
AutoToggleBtn.TextColor3 = THEME.Red
AutoToggleBtn.Font = Enum.Font.GothamBold
AutoToggleBtn.TextSize = 11
AutoToggleBtn.LayoutOrder = 4
Instance.new("UICorner", AutoToggleBtn).CornerRadius = UDim.new(0, 6)

local StatusLbl = Instance.new("TextLabel", Container)
StatusLbl.Size = UDim2.new(1, 0, 0, 20)
StatusLbl.Text = "Status: Idle"
StatusLbl.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLbl.BackgroundTransparency = 1
StatusLbl.Font = Enum.Font.Code
StatusLbl.TextSize = 10
StatusLbl.LayoutOrder = 5

-- // --- LOGIC ---

-- Fungsi Scan Path yang kamu minta
local function ScanTotems()
    -- Debugging Print (Cek console F9)
    print("Mencoba scan folder...")
    
    local targetFolder = nil
    local success, err = pcall(function()
        -- Path yang kamu minta:
        targetFolder = game:GetService("ReplicatedStorage").Modules.ModelDownloader.Collection.Totems
    end)
    
    if success and targetFolder then
        print("Folder ditemukan: " .. targetFolder:GetFullName())
        
        -- Bersihkan list lama
        for _, v in pairs(ScrollList:GetChildren()) do 
            if v:IsA("TextButton") then v:Destroy() end 
        end
        
        -- Buat tombol untuk setiap item di folder
        local count = 0
        for _, item in pairs(targetFolder:GetChildren()) do
            count = count + 1
            local btn = Instance.new("TextButton", ScrollList)
            btn.Size = UDim2.new(1, 0, 0, 25)
            btn.Text = item.Name
            btn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            btn.TextColor3 = Color3.new(0.8, 0.8, 0.8)
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 10
            
            btn.MouseButton1Click:Connect(function()
                SelectedTotemName = item.Name
                InputBox.Text = item.Name -- Isi otomatis kotak teks
                StatusLbl.Text = "Selected: " .. item.Name
            end)
        end
        
        if count == 0 then
            local lbl = Instance.new("TextLabel", ScrollList)
            lbl.Size = UDim2.new(1,0,0,30)
            lbl.Text = "Folder ditemukan tapi KOSONG."
            lbl.TextColor3 = THEME.Red
            lbl.BackgroundTransparency = 1
        end
    else
        print("Folder GAGAL ditemukan. Cek nama path.")
        local lbl = Instance.new("TextLabel", ScrollList)
        lbl.Size = UDim2.new(1,0,0,30)
        lbl.Text = "Path Error / Folder Not Found"
        lbl.TextColor3 = THEME.Red
        lbl.BackgroundTransparency = 1
    end
end

-- Fungsi Spawn (Fire Remote)
local function TriggerSpawn()
    if SelectedTotemName == "" then 
        StatusLbl.Text = "ERROR: Masukkan nama Totem dulu!"
        return 
    end

    local args = {
        [1] = SelectedTotemName
    }

    -- Mencoba Fire Remote
    local success, err = pcall(function()
        game:GetService("ReplicatedStorage").Packages._Index:FindFirstChild("sleitnick_net@0.2.0").net:FindFirstChild("RE/SpawnTotem"):FireServer(unpack(args))
    end)
    
    if success then
        StatusLbl.Text = "Spawned: " .. SelectedTotemName
    else
        StatusLbl.Text = "Remote Error!"
        warn("Error firing remote: " .. tostring(err))
    end
end

-- Logic Tombol
SpawnOnceBtn.MouseButton1Click:Connect(function()
    TriggerSpawn()
end)

AutoToggleBtn.MouseButton1Click:Connect(function()
    AutoTotemActive = not AutoTotemActive
    if AutoTotemActive then
        AutoToggleBtn.Text = "AUTO EVERY 60M: ON"
        AutoToggleBtn.TextColor3 = THEME.Accent
        
        -- Loop Auto
        task.spawn(function()
            while AutoTotemActive do
                TriggerSpawn()
                -- Countdown 60 Menit
                for i = 3600, 1, -1 do
                    if not AutoTotemActive then break end
                    StatusLbl.Text = "Next Spawn: " .. i .. "s"
                    task.wait(1)
                end
            end
        end)
    else
        AutoToggleBtn.Text = "AUTO EVERY 60M: OFF"
        AutoToggleBtn.TextColor3 = THEME.Red
        StatusLbl.Text = "Auto Stopped."
    end
end)

MinBtn.MouseButton1Click:Connect(function()
    Gui:Destroy()
end)

-- Jalankan Scan saat script start
ScanTotems()

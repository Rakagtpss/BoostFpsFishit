local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer

-- // UI CLEANUP
local function getUiParent()
    local playerGui = Player:FindFirstChild("PlayerGui")
    if playerGui then return playerGui end
    local success, core = pcall(function() return game:GetService("CoreGui") end)
    if success then return core end
    return nil
end

local ParentTarget = getUiParent()
if not ParentTarget then warn("Gagal UI Parent") return end

for _, child in pairs(ParentTarget:GetChildren()) do
    if child.Name == "SeraphinPremium" then child:Destroy() end
end

-- // UI CONFIGURATION (WIDE MODE)
local UI_WIDTH = 550
local UI_HEIGHT = 320
local SIDEBAR_WIDTH = 130
local THEME = {
    Background = Color3.fromRGB(20, 21, 24),    -- Dark Grey/Black
    Sidebar    = Color3.fromRGB(15, 15, 17),    -- Darker for Sidebar
    ItemBG     = Color3.fromRGB(30, 31, 35),    -- Lighter for items
    Text       = Color3.fromRGB(240, 240, 240), -- White
    Accent     = Color3.fromRGB(255, 255, 255), -- White Toggle
    Active     = Color3.fromRGB(0, 255, 170),   -- Seraphin Green/Teal
    Red        = Color3.fromRGB(255, 80, 80)
}

-- // GUI CREATION
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = ParentTarget
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, UI_WIDTH, 0, UI_HEIGHT)
MainFrame.Position = UDim2.new(0.5, -UI_WIDTH/2, 0.4, -UI_HEIGHT/2)
MainFrame.BackgroundColor3 = THEME.Background
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

-- Close/Minimize Button (Top Right)
local MinBtn = Instance.new("TextButton", MainFrame)
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -35, 0, 5)
MinBtn.BackgroundTransparency = 1
MinBtn.Text = "-"
MinBtn.TextColor3 = THEME.Text
MinBtn.TextSize = 24
MinBtn.Font = Enum.Font.GothamBold
MinBtn.ZIndex = 5

-- // SIDEBAR (LEFT)
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0, SIDEBAR_WIDTH, 1, 0)
Sidebar.BackgroundColor3 = THEME.Sidebar
Sidebar.BorderSizePixel = 0
local SidebarCorner = Instance.new("UICorner", Sidebar)
SidebarCorner.CornerRadius = UDim.new(0, 10)

-- Fix Corner (agar menyatu dengan MainFrame di kanan)
local FixPatch = Instance.new("Frame", Sidebar)
FixPatch.Size = UDim2.new(0, 10, 1, 0)
FixPatch.Position = UDim2.new(1, -10, 0, 0)
FixPatch.BackgroundColor3 = THEME.Sidebar
FixPatch.BorderSizePixel = 0

local TitleLabel = Instance.new("TextLabel", Sidebar)
TitleLabel.Size = UDim2.new(1, 0, 0, 50)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Seraphin | Premium"
TitleLabel.TextColor3 = THEME.Text
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 14

local TabContainer = Instance.new("Frame", Sidebar)
TabContainer.Size = UDim2.new(1, 0, 1, -60)
TabContainer.Position = UDim2.new(0, 0, 0, 60)
TabContainer.BackgroundTransparency = 1

local UIListLayout_Sidebar = Instance.new("UIListLayout", TabContainer)
UIListLayout_Sidebar.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout_Sidebar.Padding = UDim.new(0, 5)

-- // CONTENT AREA (RIGHT)
local ContentArea = Instance.new("Frame", MainFrame)
ContentArea.Size = UDim2.new(1, -SIDEBAR_WIDTH, 1, 0)
ContentArea.Position = UDim2.new(0, SIDEBAR_WIDTH, 0, 0)
ContentArea.BackgroundTransparency = 1

local Pages = {} -- Table to store page frames

-- Function to create pages
local function CreatePage(name)
    local page = Instance.new("ScrollingFrame", ContentArea)
    page.Name = name
    page.Size = UDim2.new(1, -20, 1, -20)
    page.Position = UDim2.new(0, 10, 0, 10)
    page.BackgroundTransparency = 1
    page.ScrollBarThickness = 2
    page.ScrollBarImageColor3 = THEME.Active
    page.Visible = false
    
    local layout = Instance.new("UIListLayout", page)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 8)
    
    Pages[name] = page
    return page
end

-- Function to create Sidebar Tab
local currentTab = nil
local function CreateTab(name, iconId)
    local btn = Instance.new("TextButton", TabContainer)
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.BackgroundColor3 = THEME.Sidebar
    btn.Text = "  " .. name
    btn.TextColor3 = Color3.fromRGB(150, 150, 150)
    btn.Font = Enum.Font.GothamMedium
    btn.TextSize = 12
    btn.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    
    -- Indicator
    local ind = Instance.new("Frame", btn)
    ind.Size = UDim2.new(0, 3, 0.6, 0)
    ind.Position = UDim2.new(0, 0, 0.2, 0)
    ind.BackgroundColor3 = THEME.Active
    ind.Visible = false
    
    btn.MouseButton1Click:Connect(function()
        -- Reset all tabs
        for _, child in pairs(TabContainer:GetChildren()) do
            if child:IsA("TextButton") then
                child.TextColor3 = Color3.fromRGB(150, 150, 150)
                child.BackgroundTransparency = 1
                child:FindFirstChild("Frame").Visible = false
            end
        end
        -- Activate current
        btn.TextColor3 = THEME.Text
        btn.BackgroundTransparency = 0.5 -- slight highlight
        btn.BackgroundColor3 = Color3.fromRGB(40,40,45)
        ind.Visible = true
        
        -- Switch Page
        for pname, pframe in pairs(Pages) do
            pframe.Visible = (pname == name)
        end
    end)
    
    if currentTab == nil then -- Select first tab automatically
        currentTab = btn
        btn.TextColor3 = THEME.Text
        ind.Visible = true
    end
    return btn
end

-- // COMPONENT CREATOR (TOGGLES & DROPDOWNS)
local function CreateSection(parent, title)
    local label = Instance.new("TextLabel", parent)
    label.Size = UDim2.new(1, 0, 0, 25)
    label.BackgroundTransparency = 1
    label.Text = title
    label.TextColor3 = Color3.fromRGB(120, 120, 120)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 11
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.LayoutOrder = #parent:GetChildren()
    return label
end

local function CreateToggleCard(parent, text, callback)
    local card = Instance.new("Frame", parent)
    card.Size = UDim2.new(1, 0, 0, 40)
    card.BackgroundColor3 = THEME.ItemBG
    card.LayoutOrder = #parent:GetChildren()
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 6)
    
    local label = Instance.new("TextLabel", card)
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0.05, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = THEME.Text
    label.Font = Enum.Font.GothamMedium
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local toggleBtn = Instance.new("TextButton", card)
    toggleBtn.Size = UDim2.new(0, 40, 0, 20)
    toggleBtn.Position = UDim2.new(0.85, 0, 0.5, -10)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    toggleBtn.Text = ""
    Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)
    
    local circle = Instance.new("Frame", toggleBtn)
    circle.Size = UDim2.new(0, 16, 0, 16)
    circle.Position = UDim2.new(0, 2, 0.5, -8)
    circle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
    Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)
    
    local toggled = false
    toggleBtn.MouseButton1Click:Connect(function()
        toggled = not toggled
        if toggled then
            toggleBtn.BackgroundColor3 = THEME.Active
            circle:TweenPosition(UDim2.new(1, -18, 0.5, -8), "Out", "Quad", 0.2, true)
            circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        else
            toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            circle:TweenPosition(UDim2.new(0, 2, 0.5, -8), "Out", "Quad", 0.2, true)
            circle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        end
        pcall(callback, toggled)
    end)
    return card, toggleBtn
end

local function CreateInputCard(parent, text, placeholder, defaultValue)
    local card = Instance.new("Frame", parent)
    card.Size = UDim2.new(1, 0, 0, 40)
    card.BackgroundColor3 = THEME.ItemBG
    card.LayoutOrder = #parent:GetChildren()
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 6)
    
    local label = Instance.new("TextLabel", card)
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.Position = UDim2.new(0.05, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = THEME.Text
    label.Font = Enum.Font.GothamMedium
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local box = Instance.new("TextBox", card)
    box.Size = UDim2.new(0.4, 0, 0.7, 0)
    box.Position = UDim2.new(0.55, 0, 0.15, 0)
    box.BackgroundColor3 = Color3.fromRGB(20, 20, 22)
    box.Text = defaultValue or ""
    box.PlaceholderText = placeholder
    box.TextColor3 = THEME.Active
    box.Font = Enum.Font.GothamBold
    box.TextSize = 12
    Instance.new("UICorner", box).CornerRadius = UDim.new(0, 4)
    
    return box
end

local function CreateDropdown(parent, defaultText)
    local card = Instance.new("Frame", parent)
    card.Size = UDim2.new(1, 0, 0, 35) -- Start small
    card.BackgroundColor3 = THEME.ItemBG
    card.LayoutOrder = #parent:GetChildren()
    card.ClipsDescendants = true
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 6)
    
    local btn = Instance.new("TextButton", card)
    btn.Size = UDim2.new(1, 0, 0, 35)
    btn.BackgroundTransparency = 1
    btn.Text = "  " .. defaultText
    btn.TextColor3 = THEME.Text
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 11
    btn.TextXAlignment = Enum.TextXAlignment.Left
    
    local arrow = Instance.new("TextLabel", btn)
    arrow.Size = UDim2.new(0, 30, 1, 0)
    arrow.Position = UDim2.new(1, -30, 0, 0)
    arrow.BackgroundTransparency = 1
    arrow.Text = "v"
    arrow.TextColor3 = Color3.fromRGB(150, 150, 150)
    arrow.Font = Enum.Font.GothamBold
    
    local scroll = Instance.new("ScrollingFrame", card)
    scroll.Size = UDim2.new(1, 0, 0, 150)
    scroll.Position = UDim2.new(0, 0, 0, 35)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = 2
    
    local layout = Instance.new("UIListLayout", scroll)
    layout.Padding = UDim.new(0, 2)
    
    local isOpen = false
    btn.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        if isOpen then
            card:TweenSize(UDim2.new(1, 0, 0, 185), "Out", "Quad", 0.3, true)
            arrow.Text = "^"
        else
            card:TweenSize(UDim2.new(1, 0, 0, 35), "Out", "Quad", 0.3, true)
            arrow.Text = "v"
        end
    end)
    
    return {
        Frame = card,
        Button = btn,
        Container = scroll,
        Close = function() 
            isOpen = false 
            card:TweenSize(UDim2.new(1, 0, 0, 35), "Out", "Quad", 0.3, true)
            arrow.Text = "v"
        end
    }
end

-- // PAGES SETUP
local MainPage = CreatePage("Main")
local SettingsPage = CreatePage("Settings")

CreateTab("Main", "")
CreateTab("Settings", "")

Pages["Main"].Visible = true

-- // ---------------- LOGIC VARIABLES ---------------- //
local SelectedSellItem = nil
local SelectedTotemName = nil
local KeepAmountVal = 1

local Threads = {
    Sell = nil,
    Totem = nil
}
local States = {
    Sell = false,
    Totem = false
}

-- // ---------------- PAGE: MAIN ---------------- //

-- SECTION: AUTO SELL
CreateSection(MainPage, "AUTO SELL SYSTEM")

-- 1. Scan Dropdown
local SellDropdown = CreateDropdown(MainPage, "Select Item to Sell...")

local function RefreshSellList()
    -- Clear Old
    for _, v in pairs(SellDropdown.Container:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    
    local foundItems = {}
    local itemCount = 0

    local function AddBtn(name)
        if foundItems[name] then return end
        foundItems[name] = true
        itemCount = itemCount + 1
        
        local b = Instance.new("TextButton", SellDropdown.Container)
        b.Size = UDim2.new(1, -10, 0, 25)
        b.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        b.Text = name
        b.TextColor3 = Color3.fromRGB(200, 200, 200)
        b.Font = Enum.Font.Gotham
        b.TextSize = 11
        Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
        
        b.MouseButton1Click:Connect(function()
            SelectedSellItem = name
            SellDropdown.Button.Text = "  Selected: " .. name
            SellDropdown.Close()
        end)
    end

    -- SCAN: From ReplicatedStorage Gears (Sesuai Request)
    pcall(function()
        local gearsPath = ReplicatedStorage:FindFirstChild("Modules")
        if gearsPath then gearsPath = gearsPath:FindFirstChild("ModelDownloader") end
        if gearsPath then gearsPath = gearsPath:FindFirstChild("Collection") end
        if gearsPath then gearsPath = gearsPath:FindFirstChild("Gears") end
        
        if gearsPath then
            for _, item in pairs(gearsPath:GetChildren()) do
                AddBtn(item.Name)
            end
        end
    end)
    
    -- Manual Fallback
    AddBtn("Enchant Stone")
    AddBtn("Train Wheel")
    
    SellDropdown.Container.CanvasSize = UDim2.new(0, 0, 0, itemCount * 28)
end
RefreshSellList() -- Init Load

-- 2. Keep Amount Input
local KeepInput = CreateInputCard(MainPage, "Keep Amount (Sisa)", "1", "1")
KeepInput:GetPropertyChangedSignal("Text"):Connect(function()
    KeepInput.Text = KeepInput.Text:gsub("%D+", "")
    KeepAmountVal = tonumber(KeepInput.Text) or 1
end)

-- 3. Toggle Auto Sell (UPDATED LOGIC)
CreateToggleCard(MainPage, "Enable Auto Sell", function(state)
    States.Sell = state
    if state then
        if not SelectedSellItem then 
            -- Warning visual could be added here
            print("Pilih Item dulu!") 
            return 
        end
        
        Threads.Sell = task.spawn(function()
            while States.Sell do
                task.wait(0.8) -- Delay agar tidak spam parah
                pcall(function()
                    -- TARGET REMOTE BARU (Sesuai Request)
                    -- game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/SellItem"]
                    
                    local packages = ReplicatedStorage:FindFirstChild("Packages")
                    local index = packages and packages:FindFirstChild("_Index")
                    local sleitnick = index and index:FindFirstChild("sleitnick_net@0.2.0")
                    local net = sleitnick and sleitnick:FindFirstChild("net")
                    local sellRemote = net and net:FindFirstChild("RF/SellItem")
                    
                    if not sellRemote then return end
                    
                    -- Scan Backpack REALTIME untuk item yang dimiliki
                    local backpack = Player.Backpack
                    local itemsToSell = {}
                    
                    for _, tool in pairs(backpack:GetChildren()) do
                        if tool.Name == SelectedSellItem then
                            table.insert(itemsToSell, tool)
                        end
                    end
                    
                    local amountTotal = #itemsToSell
                    local amountSell = amountTotal - KeepAmountVal
                    
                    if amountSell > 0 then
                        for i = 1, amountSell do
                            if not States.Sell then break end
                            local item = itemsToSell[i]
                            if item then
                                -- Get UUID
                                local uuid = item:GetAttribute("UUID") or item:GetAttribute("uuid") or item:GetAttribute("id")
                                if not uuid then
                                    local val = item:FindFirstChild("UUID") or item:FindFirstChild("ID")
                                    if val then uuid = val.Value end
                                end
                                
                                if uuid then
                                    sellRemote:InvokeServer(uuid)
                                    print("Sold: " .. item.Name)
                                    task.wait(0.1)
                                end
                            end
                        end
                    end
                end)
            end
        end)
    else
        if Threads.Sell then task.cancel(Threads.Sell) end
    end
end)


-- SECTION: AUTO TOTEM
CreateSection(MainPage, "AUTO TOTEM (CAVERN)")

-- 1. Totem Dropdown
local TotemDropdown = CreateDropdown(MainPage, "Select Totem...")

local function RefreshTotemList()
    -- Scan Totems Logic
    local path = ReplicatedStorage:FindFirstChild("Modules")
    if path then path = path:FindFirstChild("ModelDownloader") end
    if path then path = path:FindFirstChild("Collection") end
    if path then path = path:FindFirstChild("Totems") end
    
    if not path then return end
    
    local c = 0
    for _, t in pairs(path:GetChildren()) do
        c = c + 1
        local b = Instance.new("TextButton", TotemDropdown.Container)
        b.Size = UDim2.new(1, -10, 0, 25)
        b.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        b.Text = t.Name
        b.TextColor3 = Color3.fromRGB(200, 200, 200)
        b.Font = Enum.Font.Gotham
        b.TextSize = 11
        Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
        
        b.MouseButton1Click:Connect(function()
            SelectedTotemName = t.Name
            TotemDropdown.Button.Text = "  Totem: " .. t.Name
            TotemDropdown.Close()
        end)
    end
    TotemDropdown.Container.CanvasSize = UDim2.new(0,0,0, c*28)
end
RefreshTotemList()

-- 2. Toggle Auto Totem
CreateToggleCard(MainPage, "Enable Auto Totem", function(state)
    States.Totem = state
    if state then
        if not SelectedTotemName then return end
        Threads.Totem = task.spawn(function()
            while States.Totem do
                pcall(function()
                    -- Remote Place Cavern
                    local packages = ReplicatedStorage:WaitForChild("Packages", 5)
                    local net = packages and packages._Index["sleitnick_net@0.2.0"].net
                    local placeRemote = net and net:FindFirstChild("RE/PlaceCavernTotemItem")
                    
                    if placeRemote then
                        local tool = Player.Backpack:FindFirstChild(SelectedTotemName)
                        if not tool and Player.Character then
                             tool = Player.Character:FindFirstChild(SelectedTotemName)
                        end
                        
                        if tool then
                            local uuid = tool:GetAttribute("UUID") or tool:GetAttribute("uuid")
                             if not uuid then
                                local val = tool:FindFirstChild("UUID")
                                if val then uuid = val.Value end
                            end
                            
                            if uuid then
                                placeRemote:FireServer(uuid)
                                print("Totem Placed")
                            end
                        end
                    end
                end)
                
                -- Wait 1 hour (loop check)
                for i=1, 3600 do
                    if not States.Totem then break end
                    task.wait(1)
                end
            end
        end)
    else
        if Threads.Totem then task.cancel(Threads.Totem) end
    end
end)


-- // ---------------- PAGE: SETTINGS ---------------- //
CreateSection(SettingsPage, "PERFORMANCE")

CreateToggleCard(SettingsPage, "Booster Mode (Low GFX)", function(state)
    Lighting.GlobalShadows = not state
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("BasePart") then
            if state then v.Material = Enum.Material.SmoothPlastic else v.Material = Enum.Material.Plastic end
        end
    end
end)


-- // MINIMIZE LOGIC
local isMin = false
MinBtn.MouseButton1Click:Connect(function()
    isMin = not isMin
    if isMin then
        MainFrame:TweenSize(UDim2.new(0, UI_WIDTH, 0, 40), "Out", "Quad", 0.3, true)
        Sidebar.Visible = false
        ContentArea.Visible = false
        MinBtn.Text = "+"
    else
        MainFrame:TweenSize(UDim2.new(0, UI_WIDTH, 0, UI_HEIGHT), "Out", "Quad", 0.3, true)
        task.wait(0.2)
        Sidebar.Visible = true
        ContentArea.Visible = true
        MinBtn.Text = "-"
    end
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Seraphin Helper",
    Text = "Updated to Wide Mode!",
    Duration = 5
})

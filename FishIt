-- [1] Notifikasi Awal
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Raka Ganteng",
        Text = " Loading Sayang... (Auto Cave Added)",
        Duration = 2,
    })
end)

task.wait(3.5)

-- [2] Variable & Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage") 

local Player = Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart", 5)

Player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    HRP = newChar:WaitForChild("HumanoidRootPart", 10)
end)

-- // Konfigurasi Visual
local UI_THEME = {
    Width = 260,
    Height = 315, 
    Color = Color3.fromRGB(14, 14, 18), 
    HeaderColor = Color3.fromRGB(20, 20, 25),
    Accent = Color3.fromRGB(0, 255, 170),
    StatsColor = Color3.fromRGB(12, 12, 15),
    TextColor = Color3.fromRGB(255, 255, 255),
    SubTextColor = Color3.fromRGB(150, 150, 160),
    Font = Enum.Font.GothamBold,
    BtnFont = Enum.Font.GothamMedium 
}

-- Bersihkan UI Lama
if CoreGui:FindFirstChild("SeraphinHelper") then CoreGui.SeraphinHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [1] MINI FLOATING HUD (PANEL SERAPHIN)
-- ====================================================
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Name = "FloatingStats"
FloatHUD.Size = UDim2.new(0, 140, 0, 125) 
FloatHUD.Position = UDim2.new(0.85, 0, 0.4, 0)
FloatHUD.BackgroundColor3 = UI_THEME.StatsColor
FloatHUD.BackgroundTransparency = 0.15
FloatHUD.Visible = true
FloatHUD.Active = true
FloatHUD.Draggable = true 

-- Stroke/Border
local HudStroke = Instance.new("UIStroke", FloatHUD)
HudStroke.Color = UI_THEME.Accent
HudStroke.Thickness = 1.5
HudStroke.Transparency = 0.3

-- Corner Rounding
Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 8)

-- Layout
local ListLayout = Instance.new("UIListLayout", FloatHUD)
ListLayout.FillDirection = Enum.FillDirection.Vertical
ListLayout.Padding = UDim.new(0, 6) 
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder 

local Padding = Instance.new("UIPadding", FloatHUD)
Padding.PaddingTop = UDim.new(0, 10) 
Padding.PaddingBottom = UDim.new(0, 8)
Padding.PaddingLeft = UDim.new(0, 5)
Padding.PaddingRight = UDim.new(0, 5)

-- >> JUDUL PANEL
local TitleLabel = Instance.new("TextLabel", FloatHUD)
TitleLabel.LayoutOrder = 1
TitleLabel.Size = UDim2.new(1, 0, 0, 15)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "PANEL SERAPHIN" 
TitleLabel.TextColor3 = UI_THEME.Accent
TitleLabel.Font = Enum.Font.GothamBlack
TitleLabel.TextSize = 12
TitleLabel.TextStrokeTransparency = 0.8

-- Garis Pembatas
local Div = Instance.new("Frame", FloatHUD)
Div.LayoutOrder = 2
Div.Size = UDim2.new(0.8, 0, 0, 1)
Div.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
Div.BorderSizePixel = 0

-- >> FUNGSI STATISTIK
local function CreateStatBlock(titleText, defaultVal, order)
    local Block = Instance.new("Frame", FloatHUD)
    Block.Name = titleText.."Block"
    Block.LayoutOrder = order
    Block.Size = UDim2.new(1, 0, 0, 35) 
    Block.BackgroundTransparency = 1
    
    local LblTitle = Instance.new("TextLabel", Block)
    LblTitle.Name = "Title"
    LblTitle.Size = UDim2.new(1, 0, 0, 12)
    LblTitle.Position = UDim2.new(0, 0, 0, 0)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(titleText)
    LblTitle.TextColor3 = UI_THEME.SubTextColor
    LblTitle.Font = Enum.Font.GothamBold
    LblTitle.TextSize = 9
    
    local LblValue = Instance.new("TextLabel", Block)
    LblValue.Name = "Value"
    LblValue.Size = UDim2.new(1, 0, 0, 20)
    LblValue.Position = UDim2.new(0, 0, 0, 14)
    LblValue.BackgroundTransparency = 1
    LblValue.Text = defaultVal
    LblValue.TextColor3 = UI_THEME.TextColor
    LblValue.Font = Enum.Font.GothamBold
    LblValue.TextSize = 16 
    
    return LblValue 
end

local LblFishVal = CreateStatBlock("FISH CAUGHT", "Loading...", 3) 
local LblInvVal  = CreateStatBlock("BACKPACK", "0 / 0", 4)     


-- ====================================================
-- [2] MAIN MENU UI
-- ====================================================
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height)
Main.Position = UDim2.new(0.5, -UI_THEME.Width/2, 0.4, 0)
Main.BackgroundColor3 = UI_THEME.Color
Main.BackgroundTransparency = 0.05
Main.Active = true
Main.Draggable = true
Main.ClipsDescendants = true 
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)

local MainStroke = Instance.new("UIStroke", Main)
MainStroke.Color = UI_THEME.Accent
MainStroke.Thickness = 1.2
MainStroke.Transparency = 0.3

-- // HEADER
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 32) 
Header.BackgroundColor3 = UI_THEME.HeaderColor
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

local HeaderFiller = Instance.new("Frame", Header)
HeaderFiller.Size = UDim2.new(1, 0, 0, 5)
HeaderFiller.Position = UDim2.new(0, 0, 1, -5)
HeaderFiller.BackgroundColor3 = UI_THEME.HeaderColor
HeaderFiller.BorderSizePixel = 0

-- // TITLE
local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -60, 1, 0) 
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "SERAPHIN <font color=\"rgb(0,255,170)\">HELPER</font>"
Title.RichText = true
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = UI_THEME.Font
Title.TextSize = 12
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left 

-- // HIDE BUTTON
local HideBtn = Instance.new("TextButton", Header)
HideBtn.Size = UDim2.new(0, 45, 0, 20) 
HideBtn.Position = UDim2.new(1, -50, 0.5, -10)
HideBtn.Text = "Hide" 
HideBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
HideBtn.TextColor3 = UI_THEME.Accent
HideBtn.Font = Enum.Font.GothamBold
HideBtn.TextSize = 10
HideBtn.AutoButtonColor = true
Instance.new("UICorner", HideBtn).CornerRadius = UDim.new(0, 4)

-- // CONTAINER
local Container = Instance.new("Frame", Main)
Container.Name = "Container"
Container.Size = UDim2.new(1, -16, 1, -40) 
Container.Position = UDim2.new(0, 8, 0, 38)
Container.BackgroundTransparency = 1

local Grid = Instance.new("UIGridLayout", Container)
Grid.CellSize = UDim2.new(0, 114, 0, 28) 
Grid.CellPadding = UDim2.new(0, 6, 0, 5) 
Grid.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- ====================================================
-- [3] LOGIC & VARIABLES
-- ====================================================
local IsMinimized = false

HideBtn.MouseButton1Click:Connect(function() 
    IsMinimized = not IsMinimized 
    if IsMinimized then
        Container.Visible = false
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, 32), "Out", "Quad", 0.3, true) 
        HideBtn.Text = "Show" 
        HideBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    else
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height), "Out", "Back", 0.3, true) 
        HideBtn.Text = "Hide" 
        HideBtn.TextColor3 = UI_THEME.Accent
        task.delay(0.2, function() if not IsMinimized then Container.Visible = true end end)
    end
end)

local function MakeBtn(text)
    local b = Instance.new("TextButton", Container)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
    b.TextColor3 = Color3.fromRGB(200, 200, 200)
    b.Font = UI_THEME.BtnFont 
    b.TextSize = 10 
    b.AutoButtonColor = true
    b.ClipsDescendants = true
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4) 
    local s = Instance.new("UIStroke", b)
    s.Color = Color3.fromRGB(45, 45, 50)
    s.Thickness = 1
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    return b
end

local function ToggleVisual(btn, on)
    if on then
        btn.BackgroundColor3 = UI_THEME.Accent
        btn.TextColor3 = Color3.fromRGB(10, 10, 12)
        btn.UIStroke.Transparency = 1
        btn.Font = Enum.Font.GothamBold
    else
        btn.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
        btn.TextColor3 = Color3.fromRGB(200, 200, 200)
        btn.UIStroke.Transparency = 0
        btn.Font = UI_THEME.BtnFont
    end
end

local function Notify(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", { Title = title, Text = text, Duration = 3 })
end

-- Update States: Removed HideRod, Added AutoCave
local States = {Freeze=false, WoW=false, Boost=false, NoRender=false, Noclip=false, Panel=true, AutoEvent=false, AutoCave=false}
local SavedCFrame = nil 
local Connections = {}
local BodyV = nil

-- EVENT LIST
local EventList = {"None", "Merchant", "Megalodon", "Isonade", "Whale", "Meteor", "Kraken"}
local PrioIndex = 1
local SecIndex = 1

-- Membuat Tombol
local BtnFreeze = MakeBtn("Freeze: OFF")
local BtnWow    = MakeBtn("Water Walk: OFF")
local BtnNoclip = MakeBtn("No Clip: OFF")
local BtnBoost  = MakeBtn("Boost: OFF")
local BtnRender = MakeBtn("3D Render: ON") 
local BtnAutoCave = MakeBtn("Auto Cave: OFF") -- [NEW BUTTON REPLACING HIDE ROD]
local BtnFps    = MakeBtn("FPS: Unli") 
local BtnSave   = MakeBtn("Save Pos")
local BtnLoad   = MakeBtn("Load Pos")
local BtnRejoin = MakeBtn("Rejoin Server")
local BtnPanel  = MakeBtn("Panel Info: ON")

-- BUTTONS FOR EVENTS
local BtnPrioEvent = MakeBtn("Prio: None")
local BtnSecEvent = MakeBtn("Sec: None")
local BtnAutoEvent = MakeBtn("Auto Event: OFF")

-- FPS Counter
local fpsT = 0
RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1 
    local currentFps = math.floor(fpsT)
    Title.Text = "SERAPHIN <font color=\"rgb(0,255,170)\">HELPER</font>  |  FPS: <b>" .. currentFps .. "</b>"
end)

-- LOGIC TOMBOL
BtnFps.MouseButton1Click:Connect(function()
    local caps = {30, 60, 144, 999}
    _G.fpsIndex = ((_G.fpsIndex or 4) % #caps) + 1
    local v = caps[_G.fpsIndex]
    if setfpscap then setfpscap(v) end
    BtnFps.Text = "FPS: " .. (v > 900 and "Unlim" or v)
    ToggleVisual(BtnFps, true)
    wait(0.1)
    ToggleVisual(BtnFps, false)
end)

ToggleVisual(BtnPanel, true)
BtnPanel.MouseButton1Click:Connect(function()
    States.Panel = not States.Panel
    FloatHUD.Visible = States.Panel
    BtnPanel.Text = "Panel Info: " .. (States.Panel and "ON" or "OFF")
    ToggleVisual(BtnPanel, States.Panel)
end)

-- LOGIC EVENT SELECTION
BtnPrioEvent.MouseButton1Click:Connect(function()
    PrioIndex = PrioIndex + 1
    if PrioIndex > #EventList then PrioIndex = 1 end
    BtnPrioEvent.Text = "Prio: " .. EventList[PrioIndex]
    BtnPrioEvent.TextColor3 = UI_THEME.Accent
    task.wait(0.1)
    BtnPrioEvent.TextColor3 = Color3.fromRGB(200, 200, 200)
end)

BtnSecEvent.MouseButton1Click:Connect(function()
    SecIndex = SecIndex + 1
    if SecIndex > #EventList then SecIndex = 1 end
    BtnSecEvent.Text = "Sec: " .. EventList[SecIndex]
    BtnSecEvent.TextColor3 = UI_THEME.Accent
    task.wait(0.1)
    BtnSecEvent.TextColor3 = Color3.fromRGB(200, 200, 200)
end)

BtnAutoEvent.MouseButton1Click:Connect(function()
    States.AutoEvent = not States.AutoEvent
    BtnAutoEvent.Text = "Auto Event: " .. (States.AutoEvent and "ON" or "OFF")
    ToggleVisual(BtnAutoEvent, States.AutoEvent)
end)

-- ====================================================
-- [4] LOOPS & UPDATES
-- ====================================================

-- Loop Update HUD (Fish & Backpack)
task.spawn(function()
    while true do
        task.wait(0.5)
        if not States.Panel then continue end
        
        pcall(function()
            local ls = Player:FindFirstChild("leaderstats")
            local caughtObj = ls and ls:FindFirstChild("Caught")
            local function formatNum(n) return tostring(n):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "") end
            local val = caughtObj and caughtObj.Value or 0
            LblFishVal.Text = formatNum(val)

            local pg = Player:FindFirstChild("PlayerGui")
            local backpackGui = pg and pg:FindFirstChild("Backpack")
            local bagText = "0/?"
            if backpackGui then
                for _, v in pairs(backpackGui:GetDescendants()) do
                    if v:IsA("TextLabel") and string.find(v.Text, "/") then 
                        bagText = v.Text 
                        break 
                    end
                end
            else 
                local current = #Player.Backpack:GetChildren()
                bagText = tostring(current)
            end
            LblInvVal.Text = bagText
        end)
    end
end)

-- AUTO EVENT TELEPORT LOOP + AUTO EQUIP (EXISTING)
task.spawn(function()
    while true do
        task.wait(1.5)
        if States.AutoEvent then
            pcall(function()
                local Props = workspace:FindFirstChild("Props")
                if not Props then return end

                local TargetName = nil
                local PrioName = EventList[PrioIndex]
                local SecName = EventList[SecIndex]

                if PrioName ~= "None" then
                    for _, v in pairs(Props:GetChildren()) do
                        if string.find(v.Name:lower(), PrioName:lower()) then TargetName = v break end
                    end
                end

                if not TargetName and SecName ~= "None" then
                    for _, v in pairs(Props:GetChildren()) do
                        if string.find(v.Name:lower(), SecName:lower()) then TargetName = v break end
                    end
                end

                if TargetName and HRP then
                    local SafePart = TargetName:IsA("BasePart") and TargetName or TargetName:FindFirstChildWhichIsA("BasePart", true)
                    
                    if SafePart then
                        local dist = (HRP.Position - SafePart.Position).Magnitude
                        if dist > 50 then 
                            pcall(function()
                                local Net = ReplicatedStorage.Packages._Index:FindFirstChild("sleitnick_net@0.2.0").net
                                Net["RF/CancelFishingInputs"]:InvokeServer()
                                Net["RE/UnequipToolFromHotbar"]:FireServer()
                            end)

                            HRP.CFrame = SafePart.CFrame + Vector3.new(0, 10, 0)
                            Notify("Event Found!", "Teleporting to: " .. TargetName.Name)
                            
                            if not States.WoW then BtnWow.MouseButton1Click:Fire() end
                            
                            task.wait(0.7) 
                            pcall(function()
                                local Net = ReplicatedStorage.Packages._Index:FindFirstChild("sleitnick_net@0.2.0").net
                                Net["RE/EquipToolFromHotbar"]:FireServer(unpack({[1] = 1}))
                            end)
                            task.wait(3) 
                        end
                    end
                end
            end)
        end
    end
end)

-- Functional Logic Buttons Lainnya
BtnFreeze.MouseButton1Click:Connect(function() 
    States.Freeze = not States.Freeze 
    if HRP then HRP.Anchored = States.Freeze end 
    BtnFreeze.Text = "Freeze: " .. (States.Freeze and "ON" or "OFF")
    ToggleVisual(BtnFreeze, States.Freeze) 
end)

BtnWow.MouseButton1Click:Connect(function() 
    States.WoW = not States.WoW 
    BtnWow.Text = "Water Walk: " .. (States.WoW and "ON" or "OFF")
    ToggleVisual(BtnWow, States.WoW) 
    if States.WoW then 
        BodyV = Instance.new("BodyVelocity", HRP) 
        BodyV.MaxForce = Vector3.new(0,1e6,0) 
        BodyV.Velocity = Vector3.zero 
        Connections["WoW"] = RunService.Heartbeat:Connect(function() 
            if HRP then HRP.AssemblyLinearVelocity = Vector3.new(HRP.AssemblyLinearVelocity.X,0,HRP.AssemblyLinearVelocity.Z) end 
        end) 
    else 
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        if BodyV then BodyV:Destroy() end 
    end 
end)

BtnNoclip.MouseButton1Click:Connect(function() 
    States.Noclip = not States.Noclip 
    BtnNoclip.Text = "No Clip: "..(States.Noclip and "ON" or "OFF") 
    ToggleVisual(BtnNoclip, States.Noclip) 
    if States.Noclip then 
        Connections["Noclip"] = RunService.Stepped:Connect(function() 
            if Player.Character then 
                for _,v in pairs(Player.Character:GetDescendants()) do 
                    if v:IsA("BasePart") and v.CanCollide then v.CanCollide = false end 
                end 
            end 
        end) 
    else 
        if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end 
    end 
end)

BtnBoost.MouseButton1Click:Connect(function() 
    States.Boost = not States.Boost 
    ToggleVisual(BtnBoost, States.Boost) 
    BtnBoost.Text = "Boost: " .. (States.Boost and "ON" or "OFF")
    Lighting.GlobalShadows = not States.Boost 
    if States.Boost then
        local function CleanVisuals(folder)
            if not folder then return end
            for _, v in pairs(folder:GetDescendants()) do
                if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") or v:IsA("Explosion") then v.Enabled = false end
            end
        end
        CleanVisuals(workspace:FindFirstChild("Islands"))
        CleanVisuals(ReplicatedStorage:FindFirstChild("Assets"))
    end
end)

BtnRender.MouseButton1Click:Connect(function() 
    States.NoRender = not States.NoRender 
    RunService:Set3dRenderingEnabled(not States.NoRender) 
    BtnRender.Text = "3D Render: "..(States.NoRender and "OFF" or "ON") 
    ToggleVisual(BtnRender, States.NoRender) 
end)

-- [NEW] AUTO CAVE LOGIC (REPLACING HIDE ROD)
local InCave = false
local PreCavePos = nil

BtnAutoCave.MouseButton1Click:Connect(function()
    States.AutoCave = not States.AutoCave
    BtnAutoCave.Text = "Auto Cave: "..(States.AutoCave and "ON" or "OFF")
    ToggleVisual(BtnAutoCave, States.AutoCave)
    
    if not States.AutoCave then
        InCave = false -- Reset status jika dimatikan manual
    end
end)

-- Loop Auto Cave
task.spawn(function()
    while true do
        task.wait(1)
        if States.AutoCave and HRP then
            pcall(function()
                local Zones = workspace:FindFirstChild("Zones")
                local Cave = Zones and Zones:FindFirstChild("Christmas Cave")
                
                if Cave then
                    -- Cave Terbuka (Detected)
                    if not InCave then
                        -- Simpan Posisi Sebelum Masuk
                        PreCavePos = HRP.CFrame
                        InCave = true
                        
                        -- Teleport Masuk
                        local TargetCF = Cave:IsA("Model") and Cave:GetPivot() or Cave.CFrame
                        HRP.CFrame = TargetCF + Vector3.new(0, 5, 0)
                        
                        Notify("Cave Opened!", "Teleporting to Christmas Cave...")
                        
                        -- Optional: Auto Water Walk on jika di cave
                        if not States.WoW then BtnWow.MouseButton1Click:Fire() end
                    end
                else
                    -- Cave Tertutup/Hilang (Event Selesai)
                    if InCave then
                        InCave = false
                        if PreCavePos then
                            HRP.CFrame = PreCavePos
                            Notify("Cave Closed", "Returning to previous position...")
          

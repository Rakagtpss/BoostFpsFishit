-- [[ SERAPHIN HELPER FIXED ]] --

-- [1] Safe Notification
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Seraphin Helper",
        Text = "Memuat Interface (Safe Mode)...",
        Duration = 2,
    })
end)

-- [2] Services & Variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")

local Player = Players.LocalPlayer

-- [3] Konfigurasi UI
local UI_THEME = {
    Width = 280, 
    Height = 260, 
    Color = Color3.fromRGB(10, 10, 12), 
    Transparency = 0.25, 
    HeaderColor = Color3.fromRGB(15, 15, 18),
    Accent = Color3.fromRGB(0, 255, 170),
    TabOff = Color3.fromRGB(100, 100, 110),
    TabOn = Color3.fromRGB(0, 255, 170),
    TextColor = Color3.fromRGB(255, 255, 255),
    SubTextColor = Color3.fromRGB(150, 150, 160),
    Font = Enum.Font.GothamBold,
    BtnFont = Enum.Font.GothamMedium 
}

-- [4] Setup Parent (CoreGui / PlayerGui)
local function GetSafeParent()
    -- Coba ke CoreGui dulu, kalau gagal ke PlayerGui
    local success, result = pcall(function()
        return CoreGui
    end)
    if success and result then return result end
    return Player:WaitForChild("PlayerGui")
end

local ParentTarget = GetSafeParent()

-- Bersihkan UI Lama
if ParentTarget:FindFirstChild("SeraphinHelper") then 
    ParentTarget.SeraphinHelper:Destroy() 
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = ParentTarget
ScreenGui.ResetOnSpawn = false 
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [UI] 1. MINI FLOATING HUD
-- ====================================================
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Name = "FloatingStats"
FloatHUD.Size = UDim2.new(0, 140, 0, 125) 
FloatHUD.Position = UDim2.new(0.85, 0, 0.4, 0)
FloatHUD.BackgroundColor3 = Color3.fromRGB(10, 10, 12)
FloatHUD.BackgroundTransparency = 0.3
FloatHUD.Visible = true
FloatHUD.Active = true
FloatHUD.Draggable = true 

local HudStroke = Instance.new("UIStroke", FloatHUD)
HudStroke.Color = UI_THEME.Accent
HudStroke.Thickness = 1
HudStroke.Transparency = 0.5
Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 8)

local ListLayout = Instance.new("UIListLayout", FloatHUD)
ListLayout.FillDirection = Enum.FillDirection.Vertical
ListLayout.Padding = UDim.new(0, 6) 
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local Padding = Instance.new("UIPadding", FloatHUD)
Padding.PaddingTop = UDim.new(0, 10) 

local TitleLabel = Instance.new("TextLabel", FloatHUD)
TitleLabel.Size = UDim2.new(1, 0, 0, 15)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "PANEL SERAPHIN"
TitleLabel.TextColor3 = UI_THEME.Accent
TitleLabel.Font = Enum.Font.GothamBlack
TitleLabel.TextSize = 12

local Div = Instance.new("Frame", FloatHUD)
Div.Size = UDim2.new(0.8, 0, 0, 1)
Div.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
Div.BorderSizePixel = 0

local function CreateStatBlock(titleText, defaultVal)
    local Block = Instance.new("Frame", FloatHUD)
    Block.Size = UDim2.new(1, 0, 0, 35) 
    Block.BackgroundTransparency = 1
    
    local LblTitle = Instance.new("TextLabel", Block)
    LblTitle.Size = UDim2.new(1, 0, 0, 12)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(titleText)
    LblTitle.TextColor3 = UI_THEME.SubTextColor
    LblTitle.Font = Enum.Font.GothamBold
    LblTitle.TextSize = 9
    
    local LblValue = Instance.new("TextLabel", Block)
    LblValue.Size = UDim2.new(1, 0, 0, 20)
    LblValue.Position = UDim2.new(0, 0, 0, 14)
    LblValue.BackgroundTransparency = 1
    LblValue.Text = defaultVal
    LblValue.TextColor3 = UI_THEME.TextColor
    LblValue.Font = Enum.Font.GothamBold
    LblValue.TextSize = 16 
    
    return LblValue 
end

local LblFishVal = CreateStatBlock("FISH CAUGHT", "Loading...") 
local LblInvVal  = CreateStatBlock("BACKPACK", "0 / 0")     

-- ====================================================
-- [UI] 2. MAIN MENU UI
-- ====================================================
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height)
Main.Position = UDim2.new(0.5, -UI_THEME.Width/2, 0.4, 0)
Main.BackgroundColor3 = UI_THEME.Color
Main.BackgroundTransparency = UI_THEME.Transparency
Main.Active = true
Main.Draggable = true
Main.ClipsDescendants = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)

local MainStroke = Instance.new("UIStroke", Main)
MainStroke.Color = UI_THEME.Accent
MainStroke.Thickness = 1.2
MainStroke.Transparency = 0.4

-- HEADER
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 32) 
Header.BackgroundColor3 = UI_THEME.HeaderColor
Header.BackgroundTransparency = 0.5
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

-- TITLE
local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -60, 1, 0) 
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "SERAPHIN <font color=\"rgb(0,255,170)\">HELPER</font>"
Title.RichText = true
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = UI_THEME.Font
Title.TextSize = 12
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left 

-- HIDE BUTTON
local HideBtn = Instance.new("TextButton", Header)
HideBtn.Size = UDim2.new(0, 45, 0, 20) 
HideBtn.Position = UDim2.new(1, -50, 0.5, -10)
HideBtn.Text = "Hide" 
HideBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
HideBtn.BackgroundTransparency = 0.5
HideBtn.TextColor3 = UI_THEME.Accent
HideBtn.Font = Enum.Font.GothamBold
HideBtn.TextSize = 10
Instance.new("UICorner", HideBtn).CornerRadius = UDim.new(0, 4)
local HideStroke = Instance.new("UIStroke", HideBtn)
HideStroke.Color = UI_THEME.Accent
HideStroke.Transparency = 0.7

-- TAB SYSTEM
local TabHolder = Instance.new("Frame", Main)
TabHolder.Size = UDim2.new(1, 0, 0, 25)
TabHolder.Position = UDim2.new(0, 0, 0, 32)
TabHolder.BackgroundTransparency = 1

local TabMainBtn = Instance.new("TextButton", TabHolder)
TabMainBtn.Size = UDim2.new(0.5, 0, 1, 0)
TabMainBtn.BackgroundTransparency = 1
TabMainBtn.Text = "MAIN"
TabMainBtn.Font = Enum.Font.GothamBold
TabMainBtn.TextSize = 11
TabMainBtn.TextColor3 = UI_THEME.TabOn

local TabMiscBtn = Instance.new("TextButton", TabHolder)
TabMiscBtn.Size = UDim2.new(0.5, 0, 1, 0)
TabMiscBtn.Position = UDim2.new(0.5, 0, 0, 0)
TabMiscBtn.BackgroundTransparency = 1
TabMiscBtn.Text = "MISC"
TabMiscBtn.Font = Enum.Font.GothamBold
TabMiscBtn.TextSize = 11
TabMiscBtn.TextColor3 = UI_THEME.TabOff

local TabIndicator = Instance.new("Frame", TabHolder)
TabIndicator.Size = UDim2.new(0.5, 0, 0, 2)
TabIndicator.Position = UDim2.new(0, 0, 1, -2)
TabIndicator.BackgroundColor3 = UI_THEME.Accent
TabIndicator.BorderSizePixel = 0

-- PAGES
local PageContainer = Instance.new("Frame", Main)
PageContainer.Name = "PageContainer"
PageContainer.Size = UDim2.new(1, -16, 1, -65) 
PageContainer.Position = UDim2.new(0, 8, 0, 60)
PageContainer.BackgroundTransparency = 1

local PageMain = Instance.new("Frame", PageContainer)
PageMain.Size = UDim2.new(1, 0, 1, 0)
PageMain.BackgroundTransparency = 1
PageMain.Visible = true
local GridMain = Instance.new("UIGridLayout", PageMain)
GridMain.CellSize = UDim2.new(0, 128, 0, 28) 
GridMain.CellPadding = UDim2.new(0, 8, 0, 6) 
GridMain.HorizontalAlignment = Enum.HorizontalAlignment.Center

local PageMisc = Instance.new("Frame", PageContainer)
PageMisc.Size = UDim2.new(1, 0, 1, 0)
PageMisc.BackgroundTransparency = 1
PageMisc.Visible = false
local GridMisc = Instance.new("UIGridLayout", PageMisc)
GridMisc.CellSize = UDim2.new(0, 128, 0, 28) 
GridMisc.CellPadding = UDim2.new(0, 8, 0, 6) 
GridMisc.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- Functions
local function SwitchTab(tabName)
    if tabName == "Main" then
        PageMain.Visible = true
        PageMisc.Visible = false
        TabMainBtn.TextColor3 = UI_THEME.TabOn
        TabMiscBtn.TextColor3 = UI_THEME.TabOff
        TabIndicator:TweenPosition(UDim2.new(0, 0, 1, -2), "Out", "Quad", 0.2)
    elseif tabName == "Misc" then
        PageMain.Visible = false
        PageMisc.Visible = true
        TabMainBtn.TextColor3 = UI_THEME.TabOff
        TabMiscBtn.TextColor3 = UI_THEME.TabOn
        TabIndicator:TweenPosition(UDim2.new(0.5, 0, 1, -2), "Out", "Quad", 0.2)
    end
end
TabMainBtn.MouseButton1Click:Connect(function() SwitchTab("Main") end)
TabMiscBtn.MouseButton1Click:Connect(function() SwitchTab("Misc") end)

local function MakeBtn(parent, text)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    b.BackgroundTransparency = 0.6
    b.TextColor3 = Color3.fromRGB(200, 200, 200)
    b.Font = UI_THEME.BtnFont 
    b.TextSize = 10 
    b.AutoButtonColor = true
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4) 
    
    local s = Instance.new("UIStroke", b)
    s.Color = Color3.fromRGB(60, 60, 70)
    s.Thickness = 1
    s.Transparency = 0.5
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border 
    return b
end

local function ToggleVisual(btn, on)
    if on then
        btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0) 
        btn.BackgroundTransparency = 0.4 
        btn.TextColor3 = UI_THEME.Accent 
        btn.UIStroke.Color = UI_THEME.Accent
        btn.UIStroke.Transparency = 0 
        btn.UIStroke.Thickness = 1.2
        btn.Font = Enum.Font.GothamBold
    else
        btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        btn.BackgroundTransparency = 0.6
        btn.TextColor3 = Color3.fromRGB(200, 200, 200)
        btn.UIStroke.Color = Color3.fromRGB(60, 60, 70)
        btn.UIStroke.Transparency = 0.5
        btn.UIStroke.Thickness = 1
        btn.Font = UI_THEME.BtnFont
    end
end

-- ====================================================
-- [LOGIC] VARIABLES & CONTROLS
-- ====================================================

local States = {Freeze=false, WoW=false, Boost=false, NoRender=false, Noclip=false, Panel=true, AutoEquip=false, NetBoost=false}
local SavedCFrame = nil 
local Connections = {}
local BodyV = nil

-- Buttons
local BtnEquip  = MakeBtn(PageMain, "Auto Equip: OFF") 
local BtnFreeze = MakeBtn(PageMain, "Freeze: OFF")
local BtnWow    = MakeBtn(PageMain, "Water Walk: OFF")
local BtnNoclip = MakeBtn(PageMain, "No Clip: OFF")
local BtnBoost  = MakeBtn(PageMain, "Boost: OFF")
local BtnRender = MakeBtn(PageMain, "3D Render: ON") 
local BtnNet    = MakeBtn(PageMain, "Net Boost: OFF") 
local BtnFps    = MakeBtn(PageMain, "FPS: Unli") 

local BtnSave   = MakeBtn(PageMisc, "Save Pos")
local BtnLoad   = MakeBtn(PageMisc, "Load Pos")
local BtnRejoin = MakeBtn(PageMisc, "Rejoin Server")
local BtnPanel  = MakeBtn(PageMisc, "Panel Info: ON")

-- FPS Counter
local fpsT = 0
RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1 
    local currentFps = math.floor(fpsT)
    if Title then
        Title.Text = "SERAPHIN <font color=\"rgb(0,255,170)\">HELPER</font>  |  FPS: <b>" .. currentFps .. "</b>"
    end
end)

-- Minimize Logic
local IsMinimized = false
HideBtn.MouseButton1Click:Connect(function() 
    IsMinimized = not IsMinimized 
    if IsMinimized then
        PageContainer.Visible = false
        TabHolder.Visible = false
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, 32), "Out", "Quad", 0.3, true) 
        HideBtn.Text = "Show" 
        HideBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    else
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height), "Out", "Back", 0.3, true) 
        HideBtn.Text = "Hide" 
        HideBtn.TextColor3 = UI_THEME.Accent
        task.delay(0.2, function() 
            if not IsMinimized then 
                PageContainer.Visible = true 
                TabHolder.Visible = true
            end 
        end)
    end
end)

-- ====================================================
-- [FEATURE] SAFE LOGIC (ANTI ERROR)
-- ====================================================

-- Safe Get Character (Tanpa Wait Block)
local function GetChar()
    return Player.Character or nil
end

local function GetRoot()
    local c = GetChar()
    return c and c:FindFirstChild("HumanoidRootPart") or nil
end

-- Net Boost Logic (Safe)
BtnNet.MouseButton1Click:Connect(function()
    States.NetBoost = not States.NetBoost
    BtnNet.Text = "Net Boost: " .. (States.NetBoost and "ON" or "OFF")
    ToggleVisual(BtnNet, States.NetBoost)

    if States.NetBoost then
        task.spawn(function()
            while States.NetBoost do
                -- Menggunakan pcall agar tidak error jika settings() diproteksi
                pcall(function()
                    settings().Network.IncomingReplicationLag = 0
                end)
                task.wait(5)
            end
        end)
    end
end)

-- Auto Equip Loop
task.spawn(function()
    while true do
        task.wait(1.5)
        if States.AutoEquip then
            pcall(function()
                local c = GetChar()
                if c and not c:FindFirstChildWhichIsA("Tool") then
                     local remote = game:GetService("ReplicatedStorage").Packages._Index:FindFirstChild("sleitnick_net@0.2.0")
                     if remote then
                         remote.net:FindFirstChild("RE/EquipToolFromHotbar"):FireServer(1)
                     end
                end
            end)
        end
    end
end)

-- Update Stats Loop
task.spawn(function()
    while true do
        task.wait(0.5)
        if States.Panel then
            pcall(function()
                -- Fish
                local val = 0
                if Player:FindFirstChild("leaderstats") and Player.leaderstats:FindFirstChild("Caught") then
                    val = Player.leaderstats.Caught.Value
                end
                local function formatNum(n) return tostring(n):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "") end
                LblFishVal.Text = formatNum(val)

                -- Backpack
                local count = 0
                local pg = Player:FindFirstChild("PlayerGui")
                local found = false
                if pg and pg:FindFirstChild("Backpack") then
                    for _,v in pairs(pg.Backpack:GetDescendants()) do
                        if v:IsA("TextLabel") and string.find(v.Text, "/") then
                            LblInvVal.Text = v.Text
                            found = true
                            break
                        end
                    end
                end
                if not found and Player:FindFirstChild("Backpack") then
                     LblInvVal.Text = tostring(#Player.Backpack:GetChildren())
                end
            end)
        end
    end
end)

-- Button Actions
BtnEquip.MouseButton1Click:Connect(function()
    States.AutoEquip = not States.AutoEquip
    BtnEquip.Text = "Auto Equip: " .. (States.AutoEquip and "ON" or "OFF")
    ToggleVisual(BtnEquip, States.AutoEquip)
end)

BtnFreeze.MouseButton1Click:Connect(function() 
    States.Freeze = not States.Freeze 
    local hrp = GetRoot()
    if hrp then hrp.Anchored = States.Freeze end 
    BtnFreeze.Text = "Freeze: " .. (States.Freeze and "ON" or "OFF")
    ToggleVisual(BtnFreeze, States.Freeze) 
end)

BtnWow.MouseButton1Click:Connect(function() 
    States.WoW = not States.WoW 
    BtnWow.Text = "Water Walk: " .. (States.WoW and "ON" or "OFF")
    ToggleVisual(BtnWow, States.WoW) 
    
    local hrp = GetRoot()
    if States.WoW and hrp then 
        if BodyV then BodyV:Destroy() end
        BodyV = Instance.new("BodyVelocity", hrp) 
        BodyV.MaxForce = Vector3.new(0,1e6,0) 
        BodyV.Velocity = Vector3.zero 
        Connections["WoW"] = RunService.Heartbeat:Connect(function() 
            local h = GetRoot()
            if h then h.AssemblyLinearVelocity = Vector3.new(h.AssemblyLinearVelocity.X,0,h.AssemblyLinearVelocity.Z) end 
        end) 
    else 
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        if BodyV then BodyV:Destroy() end 
    end 
end)

BtnNoclip.MouseButton1Click:Connect(function() 
    States.Noclip = not States.Noclip 
    BtnNoclip.Text = "No Clip: "..(States.Noclip and "ON" or "OFF") 
    ToggleVisual(BtnNoclip, States.Noclip) 
    if States.Noclip then 
        Connections["Noclip"] = RunService.Stepped:Connect(function() 
            local c = GetChar()
            if c then 
                for _,v in pairs(c:GetDescendants()) do 
                    if v:IsA("BasePart") and v.CanCollide then v.CanCollide = false end 
                end 
            end 
        end) 
    else 
        if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end 
    end 
end)

BtnBoost.MouseButton1Click:Connect(function() 
    States.Boost = not States.Boost 
    ToggleVisual(BtnBoost, States.Boost) 
    BtnBoost.Text = "Boost: " .. (States.Boost and "ON" or "OFF")
    Lighting.GlobalShadows = not States.Boost 
    if States.Boost then
        local function CleanVisuals(folder)
            if not folder then return end
            for _, v in pairs(folder:GetDescendants()) do
                if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") or v:IsA("Explosion") then v.Enabled = false end
            end
        end
        CleanVisuals(workspace:FindFirstChild("Islands"))
        CleanVisuals(ReplicatedStorage:FindFirstChild("Assets"))
    end
end)

BtnRender.MouseButton1Click:Connect(function() 
    States.NoRender = not States.NoRender 
    RunService:Set3dRenderingEnabled(not States.NoRender) 
    BtnRender.Text = "3D Render: "..(States.NoRender and "OFF" or "ON") 
    ToggleVisual(BtnRender, States.NoRender) 
end)

BtnFps.MouseButton1Click:Connect(function()
    local caps = {60, 90, 144, 240, 340, 9999} 
    _G.fpsIndex = ((_G.fpsIndex or #caps) % #caps) + 1
    local v = caps[_G.fpsIndex]
    if setfpscap then setfpscap(v) end
    local textLabel = (v >= 9999) and "Max" or tostring(v)
    BtnFps.Text = "FPS: " .. textLabel
    ToggleVisual(BtnFps, true)
    task.wait(0.15)
    ToggleVisual(BtnFps, false)
end)

BtnPanel.MouseButton1Click:Connect(function()
    States.Panel = not States.Panel
    FloatHUD.Visible = States.Panel
    BtnPanel.Text = "Panel Info: " .. (States.Panel and "ON" or "OFF")
    ToggleVisual(BtnPanel, States.Panel)
end)

ToggleVisual(BtnPanel, true)

BtnSave.MouseButton1Click:Connect(function() 
    local hrp = GetRoot()
    if hrp then 
        SavedCFrame = hrp.CFrame 
        BtnSave.Text="SAVED" 
        ToggleVisual(BtnSave, true)
        task.delay(1, function()
            BtnSave.Text="Save Pos" 
            ToggleVisual(BtnSave, false)
        end)
    end 
end)

BtnLoad.MouseButton1Click:Connect(function() 
    local hrp = GetRoot()
    if SavedCFrame and hrp then 
        hrp.CFrame = SavedCFrame 
        ToggleVisual(BtnLoad,true) 
        wait(0.2) 
        ToggleVisual(BtnLoad,false) 
    end 
end)

BtnRejoin.MouseButton1Click:Connect(function() 
    TeleportService:Teleport(game.PlaceId, Player) 
end)


--[[ 
    SERAPHIN HELPER: OPTIMIZED CORE 
    Rewritten for Maximum Performance & Minimalism
]]

-- [1] SERVICES & VARIABLES
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    Teleport = game:GetService("TeleportService")
}

local LocalPlayer = Services.Players.LocalPlayer
local Character, RootPart

-- Update Character otomatis tanpa loop berat
local function UpdateChar(char)
    Character = char
    RootPart = char:WaitForChild("HumanoidRootPart", 5)
end
if LocalPlayer.Character then UpdateChar(LocalPlayer.Character) end
LocalPlayer.CharacterAdded:Connect(UpdateChar)

-- [2] THEME CONFIGURATION (Dark Glass)
local Theme = {
    MainColor = Color3.fromRGB(0, 0, 0),         -- Hitam Pekat
    Transp    = 0.55,                            -- Transparansi Kaca
    Accent    = Color3.fromRGB(0, 255, 170),     -- Hijau Neon
    Text      = Color3.fromRGB(255, 255, 255),   -- Putih
    Gray      = Color3.fromRGB(40, 40, 40),      -- Abu Gelap (Tombol)
    Font      = Enum.Font.Gotham,                -- Font Ringan
    Bold      = Enum.Font.GothamBold
}

-- [3] UI CONSTRUCTION (Clean & Fast)
if Services.CoreGui:FindFirstChild("SeraphinOpt") then Services.CoreGui.SeraphinOpt:Destroy() end
local Screen = Instance.new("ScreenGui")
Screen.Name = "SeraphinOpt"
Screen.Parent = Services.CoreGui
Screen.ResetOnSpawn = false

-- > Floating HUD
local HUD = Instance.new("Frame", Screen)
HUD.Name = "HUD"
HUD.Size = UDim2.new(0, 180, 0, 50)
HUD.Position = UDim2.new(0.85, -90, 0.2, 0)
HUD.BackgroundColor3 = Theme.MainColor
HUD.BackgroundTransparency = 0.5
HUD.Active = true
HUD.Draggable = true
Instance.new("UICorner", HUD).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", HUD).Color = Theme.Accent
HUD.UIStroke.Transparency = 0.7

local function AddLabel(parent, text, yPos)
    local l = Instance.new("TextLabel", parent)
    l.Size = UDim2.new(1, -10, 0, 20)
    l.Position = UDim2.new(0, 8, 0, yPos)
    l.BackgroundTransparency = 1
    l.Text = text
    l.TextColor3 = Theme.Text
    l.Font = Theme.Font
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.RichText = true
    return l
end
local StatFish = AddLabel(HUD, "Fetching...", 4)
local StatBag  = AddLabel(HUD, "Fetching...", 24)

-- > Main Window
local Main = Instance.new("Frame", Screen)
Main.Name = "Main"
Main.Size = UDim2.new(0, 400, 0, 260)
Main.Position = UDim2.new(0.5, -200, 0.4, 0)
Main.BackgroundColor3 = Theme.MainColor
Main.BackgroundTransparency = Theme.Transp
Main.Active = true
Main.Draggable = true
Main.ClipsDescendants = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)

-- > Header
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 32)
Header.BackgroundColor3 = Color3.new(1,1,1)
Header.BackgroundTransparency = 0.95
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(0, 200, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "SERAPHIN <font color=\"rgb(0,255,170)\">HELPER</font>"
Title.RichText = true
Title.TextColor3 = Theme.Text
Title.Font = Theme.Bold
Title.TextSize = 13
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1

local FPSLabel = Instance.new("TextLabel", Header)
FPSLabel.Size = UDim2.new(0, 60, 1, 0)
FPSLabel.Position = UDim2.new(1, -60, 0, 0)
FPSLabel.Text = "60 FPS"
FPSLabel.TextColor3 = Theme.Accent
FPSLabel.Font = Theme.Bold
FPSLabel.TextSize = 11
FPSLabel.BackgroundTransparency = 1

-- > Button Container
local Grid = Instance.new("UIGridLayout", Instance.new("Frame", Main))
Grid.Parent.Size = UDim2.new(1, -20, 1, -45)
Grid.Parent.Position = UDim2.new(0, 10, 0, 40)
Grid.Parent.BackgroundTransparency = 1
Grid.CellSize = UDim2.new(0, 185, 0, 30)
Grid.CellPadding = UDim2.new(0, 10, 0, 8)
Grid.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- [4] FEATURE LOGIC & STATE
local State = { Noclip = false, WoW = false, Boost = false, Render = true, Panel = true }
local Connections = {}
local SavedPos = nil

local function ToggleBtn(btn, isActive)
    if isActive then
        btn.BackgroundColor3 = Theme.Accent
        btn.TextColor3 = Color3.new(0,0,0)
        btn.BackgroundTransparency = 0.2
    else
        btn.BackgroundColor3 = Theme.Gray
        btn.TextColor3 = Theme.Text
        btn.BackgroundTransparency = 0.4
    end
end

local function CreateButton(text, onClick)
    local b = Instance.new("TextButton", Grid.Parent)
    b.Text = text
    b.Font = Theme.Font
    b.TextSize = 11
    b.AutoButtonColor = true
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    ToggleBtn(b, false) -- Set default visual
    
    b.MouseButton1Click:Connect(function()
        local newState = onClick()
        if newState ~= nil then ToggleBtn(b, newState) end
    end)
    return b
end

-- [5] BUTTON IMPLEMENTATION
CreateButton("Freeze Player", function()
    if RootPart then RootPart.Anchored = not RootPart.Anchored end
    return RootPart and RootPart.Anchored
end)

CreateButton("Walk On Water", function()
    State.WoW = not State.WoW
    if State.WoW then
        Connections.WoW = Services.RunService.Heartbeat:Connect(function()
            if RootPart then 
                local vel = RootPart.AssemblyLinearVelocity
                RootPart.AssemblyLinearVelocity = Vector3.new(vel.X, 0, vel.Z) -- Kunci Y axis
            end
        end)
    else
        if Connections.WoW then Connections.WoW:Disconnect() end
    end
    return State.WoW
end)

local BtnNoclip = CreateButton("No Clip: OFF", function() end) -- Placeholder logic below
BtnNoclip.MouseButton1Click:Connect(function()
    State.Noclip = not State.Noclip
    BtnNoclip.Text = "No Clip: " .. (State.Noclip and "ON" or "OFF")
    ToggleBtn(BtnNoclip, State.Noclip)
    
    if State.Noclip then
        Connections.Noclip = Services.RunService.Stepped:Connect(function()
            if Character then
                for _, v in pairs(Character:GetDescendants()) do
                    if v:IsA("BasePart") and v.CanCollide then v.CanCollide = false end
                end
            end
        end)
    else
        if Connections.Noclip then Connections.Noclip:Disconnect() end
    end
end)

CreateButton("Booster Mode", function()
    State.Boost = not State.Boost
    Services.Lighting.GlobalShadows = not State.Boost
    return State.Boost
end)

local BtnRender = CreateButton("3D Render: ON", function()
    State.Render = not State.Render
    Services.RunService:Set3dRenderingEnabled(State.Render)
    BtnRender.Text = "3D Render: " .. (State.Render and "ON" or "OFF")
    return not State.Render -- Visual invert (Active = Red/Off logic differs here but sticking to toggle style)
end)

local BtnFps = CreateButton("FPS: Unlimited", function() end)
BtnFps.MouseButton1Click:Connect(function()
    local caps = {30, 60, 144, 999}
    _G.fpsIndex = ((_G.fpsIndex or 4) % 4) + 1
    local cap = caps[_G.fpsIndex]
    if setfpscap then setfpscap(cap) end
    BtnFps.Text = "FPS: " .. (cap > 900 and "Unlimited" or cap)
end)

CreateButton("Rejoin Server", function()
    Services.Teleport:Teleport(game.PlaceId, LocalPlayer)
end)

local BtnSave = CreateButton("Save Position", function()
    if RootPart then SavedPos = RootPart.CFrame end
    BtnSave.Text = "Pos Saved!" 
    task.delay(1, function() BtnSave.Text = "Save Position" end)
    return true
end)

local BtnLoad = CreateButton("Teleport Saved", function()
    if SavedPos and RootPart then RootPart.CFrame = SavedPos end
    return true
end)

CreateButton("Toggle Panel", function()
    State.Panel = not State.Panel
    HUD.Visible = State.Panel
    return State.Panel
end)

-- [6] OPTIMIZED LOOPS (HEARTBEAT)
-- Satu loop untuk FPS counter, Satu loop lambat untuk stats

-- FPS Counter (Ringan)
local lastClock = os.clock()
local frameCount = 0
Services.RunService.RenderStepped:Connect(function()
    frameCount += 1
    local now = os.clock()
    if now - lastClock >= 1 then
        FPSLabel.Text = frameCount .. " FPS"
        frameCount = 0
        lastClock = now
    end
end)

-- Stats Updater (Jalan tiap 1 detik saja, tidak perlu real-time extrim)
task.spawn(function()
    while task.wait(1) do
        if not State.Panel then continue end
        
        -- Safe Data Fetch
        local s, err = pcall(function()
            -- Fish
            local ls = LocalPlayer:FindFirstChild("leaderstats")
            local fish = ls and ls:FindFirstChild("Caught")
            StatFish.Text = "üêü Fish: <b>" .. (fish and fish.Value or "-") .. "</b>"
            
            -- Bag
            local pg = LocalPlayer:FindFirstChild("PlayerGui")
            local bagLbl = nil
            if pg and pg:FindFirstChild("Backpack") then
                 -- Cari label yang punya format "x/y"
                for _, v in pairs(pg.Backpack:GetDescendants()) do
                    if v:IsA("TextLabel") and v.Text:find("/") then bagLbl = v.Text break end
                end
            end
            local count = bagLbl or (#LocalPlayer.Backpack:GetChildren() .. " Items")
            StatBag.Text = "üéí Bag: <b>" .. count .. "</b>"
        end)
    end
end)

print(":: SERAPHIN OPTIMIZED LOADED ::")

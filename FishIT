-[span_0](start_span)- [1] Notifikasi Awal (Safe Load)[span_0](end_span)
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Seraphin Side-UI",
        Text = "Optimized Loaded - @828_Raka",
        Duration = 2,
    })
end)

task.wait(1)

-[span_1](start_span)- [2] Variable & Services (Cached)[span_1](end_span)
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace")
}

local Player = Services.Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart", 10)
local Hum = Char:WaitForChild("Humanoid", 10)

Player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    HRP = newChar:WaitForChild("HumanoidRootPart", 10)
    Hum = newChar:WaitForChild("Humanoid", 10)
end)

-[span_2](start_span)- // Konfigurasi Visual (SIDE UI DARK THEME)[span_2](end_span)
local UI_THEME = {
    MainColor = Color3.fromRGB(15, 15, 15),     -- Background Utama Gelap
    SideColor = Color3.fromRGB(10, 10, 10),     -- Sidebar Lebih Gelap
    Accent = Color3.fromRGB(0, 255, 255),       -- Cyan Neon
    TextColor = Color3.fromRGB(255, 255, 255),
    SubText = Color3.fromRGB(150, 150, 150),
    Font = Enum.Font.GothamBold,
    BtnFont = Enum.Font.GothamMedium
}

if Services.CoreGui:FindFirstChild("SeraphinSide") then Services.CoreGui.SeraphinSide:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinSide"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [UI CONSTRUCTION - SIDEBAR STYLE]
-- ====================================================

-- Main Container (Kiri Layar)
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 360, 0, 260) -- Lebar sedikit bertambah untuk layout samping
MainFrame.Position = UDim2.new(0, 20, 0.35, 0) -- Posisi Default di Kiri
MainFrame.BackgroundColor3 = UI_THEME.MainColor
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Active = true

-- Rounded Corner & Stroke
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 6)
local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = UI_THEME.Accent
MainStroke.Thickness = 1.5
MainStroke.Transparency = 0.2

-- Sidebar (Tempat Tab)
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 90, 1, 0)
Sidebar.BackgroundColor3 = UI_THEME.SideColor
Sidebar.BorderSizePixel = 0
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, 6)

-- Separator Visual
local Separator = Instance.new("Frame", MainFrame)
Separator.Size = UDim2.new(0, 1, 1, 0)
Separator.Position = UDim2.new(0, 89, 0, 0)
Separator.BackgroundColor3 = UI_THEME.Accent
Separator.BackgroundTransparency = 0.5
Separator.BorderSizePixel = 0

-- Content Area (Tempat Tombol)
local ContentArea = Instance.new("Frame", MainFrame)
ContentArea.Name = "Content"
ContentArea.Size = UDim2.new(1, -100, 1, -40)
ContentArea.Position = UDim2.new(0, 100, 0, 35) -- Ada jarak untuk Header Title
ContentArea.BackgroundTransparency = 1

-[span_3](start_span)- Header Title (@828_Raka)[span_3](end_span)
local HeaderTitle = Instance.new("TextLabel", MainFrame)
HeaderTitle.Size = UDim2.new(1, -100, 0, 30)
HeaderTitle.Position = UDim2.new(0, 100, 0, 0)
HeaderTitle.BackgroundTransparency = 1
HeaderTitle.Text = "SERAPHIN <font color=\"rgb(0,255,255)\">SIDE</font> <font size=\"10\" color=\"rgb(120,120,120)\">@828_Raka</font>"
HeaderTitle.RichText = true
HeaderTitle.Font = UI_THEME.Font
HeaderTitle.TextColor3 = UI_THEME.TextColor
HeaderTitle.TextSize = 14
HeaderTitle.TextXAlignment = Enum.TextXAlignment.Left

-- FPS Display Kecil di Pojok
local FPSDisplay = Instance.new("TextLabel", MainFrame)
FPSDisplay.Size = UDim2.new(0, 60, 0, 20)
FPSDisplay.Position = UDim2.new(1, -65, 0, 5)
FPSDisplay.BackgroundTransparency = 1
FPSDisplay.Text = "FPS: 60"
FPSDisplay.Font = Enum.Font.Code
FPSDisplay.TextColor3 = UI_THEME.Accent
FPSDisplay.TextSize = 10

-[span_4](start_span)[span_5](start_span)- [DRAG SCRIPT][span_4](end_span)[span_5](end_span)
local function EnableDrag(frame)
    local dragToggle, dragStart, startPos
    local dragInput
    frame.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragToggle = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            dragInput = input
        end
    end)
    Services.UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragToggle then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end
EnableDrag(MainFrame)

-- ====================================================
-- [TABS & BUTTON SYSTEM]
-- ====================================================
local CurrentTab = "Main"
local Pages = {}

local function CreateTabBtn(text, order)
    local Btn = Instance.new("TextButton", Sidebar)
    Btn.Size = UDim2.new(1, -10, 0, 30)
    Btn.Position = UDim2.new(0, 5, 0, 10 + (order * 35))
    Btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Btn.Text = text
    Btn.Font = UI_THEME.Font
    Btn.TextColor3 = UI_THEME.SubText
    Btn.TextSize = 11
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 4)
    return Btn
end

local TabMain = CreateTabBtn("MAIN", 0)
local TabMisc = CreateTabBtn("MISC", 1)
local TabHide = CreateTabBtn("HIDE UI", 5) -- Tombol Hide di bawah
TabHide.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
TabHide.TextColor3 = Color3.fromRGB(255, 100, 100)

-- Container Halaman
local PageMain = Instance.new("ScrollingFrame", ContentArea)
PageMain.Size = UDim2.new(1, 0, 1, 0)
PageMain.BackgroundTransparency = 1
PageMain.ScrollBarThickness = 2
PageMain.CanvasSize = UDim2.new(0, 0, 1.2, 0)
PageMain.Visible = true
Pages["Main"] = PageMain

local LayoutMain = Instance.new("UIGridLayout", PageMain)
LayoutMain.CellSize = UDim2.new(0, 115, 0, 30)
LayoutMain.CellPadding = UDim2.new(0, 8, 0, 8)

local PageMisc = Instance.new("ScrollingFrame", ContentArea)
PageMisc.Size = UDim2.new(1, 0, 1, 0)
PageMisc.BackgroundTransparency = 1
PageMisc.ScrollBarThickness = 2
PageMisc.Visible = false
Pages["Misc"] = PageMisc

local LayoutMisc = Instance.new("UIGridLayout", PageMisc)
LayoutMisc.CellSize = UDim2.new(0, 115, 0, 30)
LayoutMisc.CellPadding = UDim2.new(0, 8, 0, 8)

local function SwitchTab(name, btn)
    for _, p in pairs(Pages) do p.Visible = false end
    Pages[name].Visible = true
    
    -- Reset warna tombol
    TabMain.TextColor3 = UI_THEME.SubText
    TabMisc.TextColor3 = UI_THEME.SubText
    TabMain.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    TabMisc.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    
    -- Highlight tombol aktif
    btn.TextColor3 = UI_THEME.Accent
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
end

TabMain.MouseButton1Click:Connect(function() SwitchTab("Main", TabMain) end)
TabMisc.MouseButton1Click:Connect(function() SwitchTab("Misc", TabMisc) end)
SwitchTab("Main", TabMain) -- Default Load

-[span_6](start_span)- Button Maker Helper[span_6](end_span)
local function MakeBtn(parent, text)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    b.TextColor3 = UI_THEME.TextColor
    b.Font = UI_THEME.BtnFont
    b.TextSize = 10
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    local s = Instance.new("UIStroke", b)
    s.Color = UI_THEME.Accent
    s.Transparency = 0.8
    return b
end

local function ToggleVisual(btn, on)
    if on then
        Services.TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = UI_THEME.Accent, TextColor3 = Color3.new(0,0,0)}):Play()
        btn.UIStroke.Transparency = 1
    else
        Services.TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 25, 25), TextColor3 = UI_THEME.TextColor}):Play()
        btn.UIStroke.Transparency = 0.8
    end
end

-- ====================================================
-- [SUPER OPTIMIZED FUNCTIONS]
-- ====================================================

-[span_7](start_span)- Improved Notify[span_7](end_span)
local function Notify(title, text)
    Services.StarterGui:SetCore("SendNotification", {Title = title, Text = text, Duration = 2})
end

-- Variables
local States = {
    AutoEvent = false, AutoEquip = false, WoW = false,
    Freeze = false, Noclip = false, Boost = false,
    AntiStuck = false, StuckTimeout = 60
}
local Connections = {}
local BodyV = nil
local LastFishTime = tick()
local LastFishCount = 0

-- >> TOMBOL UTAMA (MAIN) <<
local BtnEvent  = MakeBtn(PageMain, "Auto Event: OFF")
local BtnEquip  = MakeBtn(PageMain, "Auto Equip: OFF")
local BtnWow    = MakeBtn(PageMain, "Water Walk: OFF")
local BtnFreeze = MakeBtn(PageMain, "Freeze: OFF")
local BtnNoclip = MakeBtn(PageMain, "Noclip: OFF")
local BtnRender = MakeBtn(PageMain, "3D Render: ON")
local BtnBoost  = MakeBtn(PageMain, "üî• SUPER BOOST") -- New Booster
local BtnFps    = MakeBtn(PageMain, "Unlock FPS")

-- >> TOMBOL MISC <<
local BtnStuck  = MakeBtn(PageMisc, "Anti-Stuck: OFF")
local BtnSave   = MakeBtn(PageMisc, "Save Position")
local BtnLoad   = MakeBtn(PageMisc, "Load Position")
local BtnRejoin = MakeBtn(PageMisc, "Rejoin Server")

-- Input Anti Stuck di MISC
local InputStuck = Instance.new("TextBox", PageMisc)
InputStuck.PlaceholderText = "Timeout (s) default 60"
InputStuck.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
InputStuck.TextColor3 = UI_THEME.Accent
InputStuck.TextSize = 10
InputStuck.Font = Enum.Font.Code
InputStuck.Text = "60"
Instance.new("UICorner", InputStuck).CornerRadius = UDim.new(0, 4)
local sInput = Instance.new("UIStroke", InputStuck)
sInput.Color = UI_THEME.Accent
sInput.Transparency = 0.7

-[span_8](start_span)[span_9](start_span)- [LOGIC] SUPER CPU BOOSTER[span_8](end_span)[span_9](end_span)
-- Booster ini lebih agresif mengurangi beban CPU dan GPU
local function SuperBooster()
    local startMem = gcinfo()
    
    -- 1. Global Lighting Kill
    Services.Lighting.GlobalShadows = false
    Services.Lighting.FogEnd = 9e9
    Services.Lighting.Brightness = 0
    Services.Lighting.Technology = Enum.Technology.Compatibility
    
    -- 2. Matikan Efek Lingkungan
    if Services.Workspace:FindFirstChildOfClass("Terrain") then
        Services.Workspace.Terrain.WaterWaveSize = 0
        Services.Workspace.Terrain.WaterReflectance = 0
        Services.Workspace.Terrain.WaterTransparency = 0
        Services.Workspace.Terrain.CastShadows = false
    end

    -- 3. Deep Clean & Disable Shadows (Paling berpengaruh pada CPU)
    for _, v in pairs(Services.Workspace:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CastShadow = false -- Matikan bayangan per part
            v.Material = Enum.Material.SmoothPlastic
            v.Reflectance = 0
            if v.Transparency < 1 then v.Transparency = 0 end -- Kurangi kalkulasi transparansi
        elseif v:IsA("Decal") or v:IsA("Texture") or v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Fire") or v:IsA("Smoke") then
            v:Destroy() -- Hapus semua efek visual
        end
    end
    
    -- 4. Garbage Collect
    task.wait()
    collectgarbage("collect")
    
    local freed = math.floor(startMem - gcinfo())
    Notify("üöÄ BOOSTER", "CPU Load Reduced! Freed: " .. freed .. " KB")
end

-- [LOGIC] Functions
[span_10](start_span)local function ForceEquipRod()[span_10](end_span)
    pcall(function()
        local pkg = Services.ReplicatedStorage:FindFirstChild("Packages")
        if pkg then
            local idx = pkg:FindFirstChild("_Index")
            if idx then
                local r = idx:FindFirstChild("sleitnick_net@0.2.0")
                if r then r.net["RE/EquipToolFromHotbar"]:FireServer(1) end
            end
        end
    end)
end

-[span_11](start_span)- Update FPS[span_11](end_span)
Services.RunService.RenderStepped:Connect(function(dt)
    if MainFrame.Visible then
        FPSDisplay.Text = "FPS: " .. math.floor(1/dt)
    end
end)

-- Tombol Logika
BtnBoost.MouseButton1Click:Connect(function()
    BtnBoost.Text = "BOOSTING..."
    SuperBooster()
    task.wait(0.5)
    BtnBoost.Text = "üî• BOOSTED!"
    ToggleVisual(BtnBoost, true)
end)

BtnEvent.MouseButton1Click:Connect(function()
    States.AutoEvent = not States.AutoEvent
    BtnEvent.Text = "Auto Event: " .. (States.AutoEvent and "ON" or "OFF")
    ToggleVisual(BtnEvent, States.AutoEvent)
    
    if not States.AutoEvent then
        if BodyV then BodyV:Destroy() BodyV = nil end
    end
end)

BtnEquip.MouseButton1Click:Connect(function()
    States.AutoEquip = not States.AutoEquip
    BtnEquip.Text = "Auto Equip: " .. (States.AutoEquip and "ON" or "OFF")
    ToggleVisual(BtnEquip, States.AutoEquip)
end)

BtnWow.MouseButton1Click:Connect(function()
    States.WoW = not States.WoW
    BtnWow.Text = "Water Walk: " .. (States.WoW and "ON" or "OFF")
    ToggleVisual(BtnWow, States.WoW)
    
    if States.WoW then
        Connections["WoW"] = Services.RunService.RenderStepped:Connect(function()
            if not HRP then return end
            if not BodyV then
                BodyV = Instance.new("BodyVelocity", HRP)
                BodyV.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            end
            local md = Hum.MoveDirection
            if md.Magnitude > 0 then
                BodyV.Velocity = Vector3.new(md.X * 16, 0, md.Z * 16)
            else
                BodyV.Velocity = Vector3.zero
            end
        end)
    else
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end
        if BodyV then BodyV:Destroy() BodyV = nil end
    end
end)

BtnFreeze.MouseButton1Click:Connect(function()
    States.Freeze = not States.Freeze
    if HRP then HRP.Anchored = States.Freeze end
    BtnFreeze.Text = "Freeze: " .. (States.Freeze and "ON" or "OFF")
    ToggleVisual(BtnFreeze, States.Freeze)
end)

BtnNoclip.MouseButton1Click:Connect(function()
    States.Noclip = not States.Noclip
    BtnNoclip.Text = "Noclip: " .. (States.Noclip and "ON" or "OFF")
    ToggleVisual(BtnNoclip, States.Noclip)
    
    if States.Noclip then
        Connections["Noclip"] = Services.RunService.Stepped:Connect(function()
            if Char then
                for _, v in pairs(Char:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        end)
    else
        if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end
    end
end)

BtnRender.MouseButton1Click:Connect(function()
    Services.RunService:Set3dRenderingEnabled(not Services.RunService:Is3dRenderingEnabled())
    local isOn = Services.RunService:Is3dRenderingEnabled()
    BtnRender.Text = "3D Render: " .. (isOn and "ON" or "OFF")
    ToggleVisual(BtnRender, not isOn)
end)

BtnFps.MouseButton1Click:Connect(function()
    if setfpscap then setfpscap(9999) end
    BtnFps.Text = "FPS Unlocked"
    ToggleVisual(BtnFps, true)
end)

-- Tab Hide Logic
local isHidden = false
TabHide.MouseButton1Click:Connect(function()
    isHidden = not isHidden
    if isHidden then
        MainFrame:TweenSize(UDim2.new(0, 90, 0, 40), "Out", "Quad", 0.3)
        ContentArea.Visible = false
        Sidebar.Visible = false
        HeaderTitle.Text = "OPEN"
        HeaderTitle.Position = UDim2.new(0, 10, 0, 0)
    else
        MainFrame:TweenSize(UDim2.new(0, 360, 0, 260), "Out", "Back", 0.3)
        task.wait(0.2)
        ContentArea.Visible = true
        Sidebar.Visible = true
        HeaderTitle.Text = "SERAPHIN <font color=\"rgb(0,255,255)\">SIDE</font> <font size=\"10\" color=\"rgb(120,120,120)\">@828_Raka</font>"
        HeaderTitle.Position = UDim2.new(0, 100, 0, 0)
    end
end)

-- Anti Stuck & Misc
BtnStuck.MouseButton1Click:Connect(function()
    States.AntiStuck = not States.AntiStuck
    BtnStuck.Text = "Anti-Stuck: " .. (States.AntiStuck and "ON" or "OFF")
    ToggleVisual(BtnStuck, States.AntiStuck)
    if States.AntiStuck then
        LastFishTime = tick()
        local val = tonumber(InputStuck.Text) or 60
        States.StuckTimeout = val
    end
end)

local SavedPos = nil
BtnSave.MouseButton1Click:Connect(function()
    if HRP then SavedPos = HRP.CFrame Notify("Pos", "Position Saved!") end
end)
BtnLoad.MouseButton1Click:Connect(function()
    if HRP and SavedPos then HRP.CFrame = SavedPos end
end)
BtnRejoin.MouseButton1Click:Connect(function()
    Services.TeleportService:Teleport(game.PlaceId, Player)
end)

-- ====================================================
-[span_12](start_span)[span_13](start_span)[span_14](start_span)- [OPTIMIZED LOOPS][span_12](end_span)[span_13](end_span)[span_14](end_span)
-- ====================================================

-- 1. Auto Event Loop (Throttled: Cek setiap 3 detik, bukan 1)
task.spawn(function()
    while true do
        task.wait(3) -- [Optimasi] Jarang cek agar CPU ringan
        if States.AutoEvent then
            pcall(function()
                if not HRP then return end
                local Props = Services.Workspace:FindFirstChild("Props")
                if not Props then return end
                
                -- Cari Event hanya jika belum ketemu
                local Found = nil
                for _, v in ipairs(Props:GetChildren()) do
                    if v:IsA("Model") or v:IsA("BasePart") then
                        Found = v
                        break
                    end
                end
                
                if Found then
                    local target = Found:GetPivot().Position
                    if (HRP.Position - target).Magnitude > 15 then
                        HRP.CFrame = CFrame.new(target + Vector3.new(0, 5, 0))
                    end
                end
            end)
        end
    end
end)

-- 2. Auto Equip (Throttled: Cek setiap 2.5 detik)
task.spawn(function()
    while true do
        task.wait(2.5)
        if States.AutoEquip then ForceEquipRod() end
    end
end)

-- 3. Anti Stuck (Throttled: Cek setiap 1 detik)
task.spawn(function()
    while true do
        task.wait(1)
        if States.AntiStuck then
            pcall(function()
                local ls = Player:FindFirstChild("leaderstats")
                local cur = (ls and ls:FindFirstChild("Caught")) and ls.Caught.Value or 0
                
                if cur > LastFishCount then
                    LastFishCount = cur
                    LastFishTime = tick()
                elseif (tick() - LastFishTime) > States.StuckTimeout then
                    Notify("‚ö†Ô∏è STUCK", "Respawning...")
                    local oldPos = HRP.CFrame
                    if Hum then Hum.Health = 0 end
                    Player.CharacterAdded:Wait()
                    task.wait(1)
                    if Player.Character then
                        Player.Character:SetPrimaryPartCFrame(oldPos)
                    end
                    LastFishTime = tick()
                end
            end)
        else
            LastFishTime = tick()
        end
    end
end)

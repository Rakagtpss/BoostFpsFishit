-- [1] SERVICES & VARIABLES
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace")
}

local Player = Services.Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart", 10)
local Hum = Char:WaitForChild("Humanoid", 10)

-- [2] REMOTE SETUP (FISCH)
-- Pastikan path ini sesuai dengan game Fisch saat ini
local NetPath = Services.ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
local Remotes = {
    Charge = NetPath:FindFirstChild("RF/ChargeFishingRod"),
    Request = NetPath:FindFirstChild("RF/RequestFishingMinigameStarted"),
    Complete = NetPath:FindFirstChild("RE/FishingCompleted"),
    Cancel = NetPath:FindFirstChild("RF/CancelFishingInputs"),
    Sell = NetPath:FindFirstChild("RF/SellAllItems"),
    Weather = NetPath:FindFirstChild("RF/PurchaseWeather") or NetPath:FindFirstChild("RF/WeatherChange"),
    Equip = NetPath:FindFirstChild("RE/EquipToolFromHotbar")
}

-- [3] UI CONFIGURATION (SIDE UI)
local UI_THEME = {
    MinWidth = 260,
    MinHeight = 220,  
    Color = Color3.fromRGB(35, 35, 35),       
    SidebarColor = Color3.fromRGB(25, 25, 25),
    HeaderColor = Color3.fromRGB(45, 45, 45), 
    Accent = Color3.fromRGB(100, 100, 100),   
    TabOff = Color3.fromRGB(120, 120, 120),
    TabOn = Color3.fromRGB(255, 255, 255),
    TextColor = Color3.fromRGB(255, 255, 255),
    SubTextColor = Color3.fromRGB(180, 180, 180),
    Font = Enum.Font.GothamBold,
    BtnFont = Enum.Font.GothamMedium 
}

-- STATES & SETTINGS
local States = {
    -- Fishing
    Fishing = false, Mode = "Instant", 
    DelayBait = 1.15, DelayReel = 0.56, DelayReset = 0.2,
    -- Automation
    AutoSell = false, SellInterval = 10,
    AutoWeather = false, WeatherList = {},
    -- Original Features
    Freeze=false, WoW=false, Boost=false, Ultra=false, NoRender=false, 
    Noclip=false, Panel=true, AutoEquip=false, AutoClean=false,
    AutoEvent=false, AntiStuck=false, StuckTimeout=60 
}

local FishingArgs = { -1.115296483039856, 0, 1763651451.636425 }
local AvailableWeathers = {"Windy", "Rain", "Fog", "Snow", "Clear", "Aurora"} 
local RestoreData = {} -- Untuk graphics restore
local Connections = {} -- Untuk menyimpan loop renderstepped
local BodyV = nil -- Untuk water walk
local LastFishCount = 0
local LastFishCaughtTime = tick()
local SavedCFrame = nil
local EventStartCFrame = nil
local IsInEvent = false

-- CLEANUP OLD UI
if Services.CoreGui:FindFirstChild("SeraphinHelper") then Services.CoreGui.SeraphinHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [SYSTEM] NOTIFICATION
-- ====================================================
local NotifyContainer = Instance.new("Frame", ScreenGui)
NotifyContainer.Name = "NotificationContainer"
NotifyContainer.Size = UDim2.new(0, 260, 0.6, 0)
NotifyContainer.AnchorPoint = Vector2.new(1, 1)
NotifyContainer.Position = UDim2.new(1, -20, 1, -20)
NotifyContainer.BackgroundTransparency = 1
local NotifyLayout = Instance.new("UIListLayout", NotifyContainer)
NotifyLayout.FillDirection = Enum.FillDirection.Vertical
NotifyLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifyLayout.Padding = UDim.new(0, 6)

local function Notify(title, text, colorOverride)
    local color = colorOverride or UI_THEME.Accent
    local Frame = Instance.new("Frame", NotifyContainer)
    Frame.Size = UDim2.new(1, 0, 0, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Frame.BackgroundTransparency = 0.1
    local Stroke = Instance.new("UIStroke", Frame)
    Stroke.Color = color
    Stroke.Thickness = 1.5
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local LblTitle = Instance.new("TextLabel", Frame)
    LblTitle.Size = UDim2.new(1, -12, 0, 15)
    LblTitle.Position = UDim2.new(0, 6, 0, 4)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(title)
    LblTitle.TextColor3 = color
    LblTitle.Font = Enum.Font.GothamBlack
    LblTitle.TextSize = 12
    LblTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    local LblMsg = Instance.new("TextLabel", Frame)
    LblMsg.Size = UDim2.new(1, -12, 0, 20)
    LblMsg.Position = UDim2.new(0, 6, 0, 18)
    LblMsg.BackgroundTransparency = 1
    LblMsg.Text = text
    LblMsg.TextColor3 = Color3.fromRGB(255, 255, 255)
    LblMsg.Font = Enum.Font.GothamBold
    LblMsg.TextSize = 10
    LblMsg.TextXAlignment = Enum.TextXAlignment.Left

    Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(1, 0, 0, 45)}):Play()
    task.delay(3, function() if Frame then Frame:Destroy() end end)
end

Notify("SERAPHIN", "Full Script Loaded - @828_Raka", UI_THEME.Accent)

-- ====================================================
-- [UI CONSTRUCTION]
-- ====================================================
-- 1. Floating HUD
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Name = "FloatingStats"
FloatHUD.Size = UDim2.new(0, 140, 0, 125)
FloatHUD.Position = UDim2.new(0.85, 0, 0.4, 0)
FloatHUD.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
FloatHUD.BackgroundTransparency = 0.3
FloatHUD.Visible = false
Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 8)
local HudStroke = Instance.new("UIStroke", FloatHUD)
HudStroke.Color = UI_THEME.Accent; HudStroke.Thickness = 1.5
local ListLayout = Instance.new("UIListLayout", FloatHUD)
ListLayout.FillDirection = Enum.FillDirection.Vertical
ListLayout.Padding = UDim.new(0, 6)
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
Instance.new("UIPadding", FloatHUD).PaddingTop = UDim.new(0, 10)

local HudTitle = Instance.new("TextLabel", FloatHUD)
HudTitle.Size = UDim2.new(1,0,0,15); HudTitle.BackgroundTransparency = 1
HudTitle.Text = "PANEL SERAPHIN"; HudTitle.TextColor3 = UI_THEME.Accent
HudTitle.Font = Enum.Font.GothamBlack; HudTitle.TextSize = 14

local function CreateStatBlock(title, default)
    local b = Instance.new("Frame", FloatHUD)
    b.Size = UDim2.new(1,0,0,35); b.BackgroundTransparency = 1
    local t = Instance.new("TextLabel", b)
    t.Size = UDim2.new(1,0,0,12); t.BackgroundTransparency = 1
    t.Text = string.upper(title); t.TextColor3 = UI_THEME.SubTextColor
    t.Font = Enum.Font.GothamBold; t.TextSize = 9
    local v = Instance.new("TextLabel", b)
    v.Size = UDim2.new(1,0,0,20); v.Position = UDim2.new(0,0,0,14); v.BackgroundTransparency = 1
    v.Text = default; v.TextColor3 = UI_THEME.TextColor
    v.Font = Enum.Font.GothamBold; v.TextSize = 16
    return v
end
local LblFishVal = CreateStatBlock("FISH CAUGHT", "Loading...")
local LblInvVal = CreateStatBlock("BACKPACK", "0/?")

-- 2. Main Window
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, UI_THEME.MinWidth, 0, UI_THEME.MinHeight)
Main.Position = UDim2.new(0, 20, 0.4, 0)
Main.BackgroundColor3 = UI_THEME.Color
Main.BackgroundTransparency = UI_THEME.Transparency
Main.ClipsDescendants = true 
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
local MainStroke = Instance.new("UIStroke", Main)
MainStroke.Color = UI_THEME.Accent; MainStroke.Thickness = 1.5

-- Header
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 32)
Header.BackgroundColor3 = UI_THEME.HeaderColor
Header.BackgroundTransparency = 0.5
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -10, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "SERA HELPER <font size=\"9\" color=\"rgb(180,180,180)\">By @828_raka</font>"
Title.RichText = true; Title.TextColor3 = Color3.new(1,1,1)
Title.Font = UI_THEME.Font; Title.TextSize = 11; Title.BackgroundTransparency = 1; Title.TextXAlignment = Enum.TextXAlignment.Left

-- Dragging
local function EnableDrag(frame, inputSource)
    local dragging, dragInput, dragStart, startPos
    inputSource.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = frame.Position
        end
    end)
    inputSource.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    Services.UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    inputSource.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
end
EnableDrag(Main, Header)
EnableDrag(FloatHUD, FloatHUD)

-- Sidebar (Vertical Tabs)
local SidebarWidth = 65
local Sidebar = Instance.new("Frame", Main)
Sidebar.Size = UDim2.new(0, SidebarWidth, 1, -32)
Sidebar.Position = UDim2.new(0, 0, 0, 32)
Sidebar.BackgroundColor3 = UI_THEME.SidebarColor
Sidebar.BackgroundTransparency = 0.5
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, 8)
local TabList = Instance.new("UIListLayout", Sidebar)
TabList.SortOrder = Enum.SortOrder.LayoutOrder

local function CreateTabBtn(text, order)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.BackgroundTransparency = 1
    btn.Text = text; btn.Font = Enum.Font.GothamBold; btn.TextSize = 10
    btn.TextColor3 = UI_THEME.TabOff; btn.LayoutOrder = order
    return btn
end
local TabMain = CreateTabBtn("MAIN", 1)
local TabFish = CreateTabBtn("FISH", 2)
local TabMisc = CreateTabBtn("MISC", 3)
local Indicator = Instance.new("Frame", Sidebar)
Indicator.Size = UDim2.new(0, 3, 0, 40)
Indicator.BackgroundColor3 = UI_THEME.Accent; Indicator.BorderSizePixel = 0

-- Pages
local PageContainer = Instance.new("Frame", Main)
PageContainer.Size = UDim2.new(1, -(SidebarWidth + 10), 1, -40)
PageContainer.Position = UDim2.new(0, SidebarWidth + 5, 0, 38)
PageContainer.BackgroundTransparency = 1

local function CreatePage(name)
    local p = Instance.new("ScrollingFrame", PageContainer)
    p.Name = name; p.Size = UDim2.new(1, 0, 1, 0); p.BackgroundTransparency = 1
    p.ScrollBarThickness = 2; p.ScrollBarImageColor3 = UI_THEME.Accent
    p.AutomaticCanvasSize = Enum.AutomaticSize.Y; p.CanvasSize = UDim2.new(0,0,0,0)
    p.Visible = false
    local g = Instance.new("UIGridLayout", p)
    g.CellSize = UDim2.new(1, -5, 0, 26); g.CellPadding = UDim2.new(0, 0, 0, 5)
    return p
end
local PageMain = CreatePage("PageMain")
local PageFish = CreatePage("PageFish")
local PageMisc = CreatePage("PageMisc")

local function SwitchTab(target)
    PageMain.Visible = false; PageFish.Visible = false; PageMisc.Visible = false
    TabMain.TextColor3 = UI_THEME.TabOff; TabFish.TextColor3 = UI_THEME.TabOff; TabMisc.TextColor3 = UI_THEME.TabOff
    if target == "Main" then
        PageMain.Visible = true; TabMain.TextColor3 = UI_THEME.TabOn
        Indicator:TweenPosition(UDim2.new(0,0,0,0), "Out", "Quad", 0.2)
    elseif target == "Fish" then
        PageFish.Visible = true; TabFish.TextColor3 = UI_THEME.TabOn
        Indicator:TweenPosition(UDim2.new(0,0,0,40), "Out", "Quad", 0.2)
    elseif target == "Misc" then
        PageMisc.Visible = true; TabMisc.TextColor3 = UI_THEME.TabOn
        Indicator:TweenPosition(UDim2.new(0,0,0,80), "Out", "Quad", 0.2)
    end
end
TabMain.MouseButton1Click:Connect(function() SwitchTab("Main") end)
TabFish.MouseButton1Click:Connect(function() SwitchTab("Fish") end)
TabMisc.MouseButton1Click:Connect(function() SwitchTab("Misc") end)
SwitchTab("Main")

-- Helper Functions
local function MakeBtn(parent, text, callback)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    b.BackgroundTransparency = 0.5
    b.TextColor3 = UI_THEME.TextColor
    b.Font = UI_THEME.BtnFont; b.TextSize = 9; b.AutoButtonColor = true
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    local s = Instance.new("UIStroke", b)
    s.Color = UI_THEME.Accent; s.Thickness = 1; s.Transparency = 0.6
    if callback then b.MouseButton1Click:Connect(callback) end
    return b
end

local function ToggleVisual(btn, on, textOn, textOff)
    if on then
        btn.BackgroundColor3 = UI_THEME.Accent; btn.BackgroundTransparency = 0.2
        btn.TextColor3 = Color3.fromRGB(0, 0, 0); btn.Font = Enum.Font.GothamBold; btn.UIStroke.Transparency = 1
        if textOn then btn.Text = textOn end
    else
        btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0); btn.BackgroundTransparency = 0.5
        btn.TextColor3 = UI_THEME.TextColor; btn.Font = UI_THEME.BtnFont; btn.UIStroke.Transparency = 0.6
        if textOff then btn.Text = textOff end
    end
end

-- ====================================================
-- [LOGIC & FUNCTIONS]
-- ====================================================

-- 1. Graphics Logic
local function SetUltraGraphics(enabled)
    States.Ultra = enabled
    if enabled then
        pcall(function() settings().Rendering.QualityLevel = "Level21" end)
        Services.Lighting.GlobalShadows = true
        Services.Lighting.Technology = Enum.Technology.Future 
        -- Create FX
        local b = Instance.new("BloomEffect", Services.Lighting); b.Name="S_Bloom"; b.Intensity=0.8
        local c = Instance.new("ColorCorrectionEffect", Services.Lighting); c.Name="S_Color"; c.Saturation=0.25
        Notify("GRAPHICS", "Ultra HD Enabled", Color3.fromRGB(0, 255, 255))
    else
        for _,v in pairs(Services.Lighting:GetChildren()) do if v.Name:find("S_") then v:Destroy() end end
        Notify("GRAPHICS", "Ultra HD Disabled", UI_THEME.Accent)
    end
end

local function ToggleBoost(enable)
    States.Boost = enable
    if enable then
        if States.Ultra then SetUltraGraphics(false) end
        Services.Lighting.GlobalShadows = false
        pcall(function() settings().Rendering.QualityLevel = "Level01" end)
        for _, v in pairs(Services.Workspace:GetDescendants()) do
            if v:IsA("BasePart") then v.Material = Enum.Material.SmoothPlastic end
            if v:IsA("Texture") then v.Transparency = 1 end
        end
        Notify("BOOSTER", "FPS Boost Active", Color3.fromRGB(0, 255, 100))
    else
        Notify("BOOSTER", "Restoring...", UI_THEME.Accent)
    end
end

-- 2. Movement Logic (WoW)
local function SetWoW(bool)
    States.WoW = bool
    if States.WoW then
        if not BodyV then
            BodyV = Instance.new("BodyVelocity")
            BodyV.Name = "WoW_Vel"; BodyV.MaxForce = Vector3.one * math.huge
        end
        BodyV.Parent = HRP
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end
        Connections["WoW"] = Services.RunService.RenderStepped:Connect(function()
            if HRP and Hum and BodyV.Parent then
                local md = Hum.MoveDirection
                BodyV.Velocity = Vector3.new(md.X*16, 0, md.Z*16)
            end
        end)
    else
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end
        if BodyV then BodyV:Destroy(); BodyV = nil end
    end
end

-- 3. Force Equip
local function ForceEquipRod()
    if Remotes.Equip then pcall(function() Remotes.Equip:FireServer(1) end) end
end

-- 4. Fishing Logic
local function StartFishingLoop()
    if States.Mode == "Blatant" then
        task.spawn(function()
            pcall(function() Remotes.Cancel:InvokeServer() end)
            task.wait(0.05)
            while States.Fishing do
                task.spawn(function() pcall(function() Remotes.Charge:InvokeServer() end) end)
                task.spawn(function() pcall(function() Remotes.Request:InvokeServer(unpack(FishingArgs)) end) end)
                task.wait(States.DelayBait)
                pcall(function() Remotes.Complete:FireServer() end)
                task.wait(States.DelayReset)
                pcall(function() Remotes.Cancel:InvokeServer() end)
                task.wait(States.DelayReel)
            end
        end)
    else
        task.spawn(function()
            while States.Fishing do
                pcall(function() Remotes.Charge:InvokeServer() end)
                task.wait(States.DelayBait)
                if not States.Fishing then break end
                pcall(function() Remotes.Request:InvokeServer(unpack(FishingArgs)) end)
                task.wait(States.DelayReel)
                if not States.Fishing then break end
                pcall(function() Remotes.Complete:FireServer() end)
                task.wait(States.DelayReset)
                pcall(function() Remotes.Cancel:InvokeServer() end)
            end
        end)
    end
end

-- ====================================================
-- [TAB CONTENT]
-- ====================================================

-- [[ PAGE FISH ]]
local ModeBtn = MakeBtn(PageFish, "Mode: Instant")
local BaitInput = Instance.new("TextBox", PageFish)
local ReelInput = Instance.new("TextBox", PageFish)
local StartFishBtn = MakeBtn(PageFish, "Start Fishing: OFF")

local function SetupInput(box, ph, val)
    box.BackgroundColor3=Color3.new(0,0,0); box.BackgroundTransparency=0.5
    box.TextColor3=UI_THEME.Accent; box.Font=Enum.Font.GothamBold; box.TextSize=10
    box.PlaceholderText=ph; box.Text=val
    Instance.new("UICorner", box).CornerRadius=UDim.new(0,4)
    local s = Instance.new("UIStroke", box); s.Color=UI_THEME.Accent; s.Transparency=0.6
end
SetupInput(BaitInput, "Delay Bait", tostring(States.DelayBait))
SetupInput(ReelInput, "Delay Reel", tostring(States.DelayReel))

BaitInput.FocusLost:Connect(function() local n=tonumber(BaitInput.Text); if n then States.DelayBait=n end end)
ReelInput.FocusLost:Connect(function() local n=tonumber(ReelInput.Text); if n then States.DelayReel=n end end)

ModeBtn.MouseButton1Click:Connect(function()
    States.Mode = (States.Mode == "Instant") and "Blatant" or "Instant"
    ModeBtn.Text = "Mode: " .. States.Mode
end)

StartFishBtn.MouseButton1Click:Connect(function()
    States.Fishing = not States.Fishing
    ToggleVisual(StartFishBtn, States.Fishing, "Fishing: RUNNING", "Fishing: OFF")
    if States.Fishing then Notify("FISHING", "Started ("..States.Mode..")", Color3.fromRGB(0,255,0)); StartFishingLoop()
    else Notify("FISHING", "Stopped", Color3.fromRGB(255,100,100)) end
end)

-- [[ PAGE MAIN ]]
-- Auto Sell
local SellBtn = MakeBtn(PageMain, "Auto Sell: OFF", function(s)
    States.AutoSell = not States.AutoSell
    ToggleVisual(s, States.AutoSell, "Auto Sell: ON", "Auto Sell: OFF")
    if States.AutoSell then
        task.spawn(function()
            while States.AutoSell do
                if Remotes.Sell then pcall(function() Remotes.Sell:InvokeServer() end) end
                task.wait(States.SellInterval)
            end
        end)
    end
end)

-- Weather List
local WeatherContainer = Instance.new("Frame", PageMain)
WeatherContainer.Size=UDim2.new(1,0,0,60); WeatherContainer.BackgroundTransparency=1; WeatherContainer.Visible=false
local WGrid = Instance.new("UIGridLayout", WeatherContainer)
WGrid.CellSize=UDim2.new(0.3,0,0,20); WGrid.CellPadding=UDim2.new(0,4,0,4)
for _, w in pairs(AvailableWeathers) do
    local wb = Instance.new("TextButton", WeatherContainer)
    wb.Text=w; wb.BackgroundColor3=Color3.fromRGB(20,20,20); wb.TextColor3=Color3.fromRGB(150,150,150); wb.Font=Enum.Font.GothamBold; wb.TextSize=8
    Instance.new("UICorner", wb).CornerRadius=UDim.new(0,4)
    wb.MouseButton1Click:Connect(function()
        if table.find(States.WeatherList, w) then
            for i,v in pairs(States.WeatherList) do if v==w then table.remove(States.WeatherList, i) end end
            wb.TextColor3=Color3.fromRGB(150,150,150)
        elseif #States.WeatherList < 3 then
            table.insert(States.WeatherList, w); wb.TextColor3=Color3.fromRGB(0,255,255)
        end
    end)
end
MakeBtn(PageMain, "Select Weather >", function(s) WeatherContainer.Visible = not WeatherContainer.Visible end)

MakeBtn(PageMain, "Auto Buy Weather: OFF", function(s)
    States.AutoWeather = not States.AutoWeather
    ToggleVisual(s, States.AutoWeather, "Auto Buy Weather: ON", "Auto Buy Weather: OFF")
    if States.AutoWeather then
        task.spawn(function()
            while States.AutoWeather do
                if Remotes.Weather and #States.WeatherList > 0 then
                    for _, w in pairs(States.WeatherList) do
                        pcall(function() Remotes.Weather:InvokeServer(w) end); task.wait(2)
                    end
                end
                task.wait(5)
            end
        end)
    end
end)

-- Original Features Buttons
MakeBtn(PageMain, "Auto Event: OFF", function(s)
    States.AutoEvent = not States.AutoEvent
    ToggleVisual(s, States.AutoEvent, "Auto Event: ON", "Auto Event: OFF")
    if not States.AutoEvent and IsInEvent and EventStartCFrame and HRP then HRP.CFrame = EventStartCFrame; SetWoW(false) end
end)

MakeBtn(PageMain, "Auto Equip: OFF", function(s) States.AutoEquip = not States.AutoEquip; ToggleVisual(s, States.AutoEquip, "Auto Equip: ON", "Auto Equip: OFF") end)
MakeBtn(PageMain, "Auto Clean: OFF", function(s) States.AutoClean = not States.AutoClean; ToggleVisual(s, States.AutoClean, "Auto Clean: ON", "Auto Clean: OFF") end)
MakeBtn(PageMain, "Ultra HD: OFF", function(s) SetUltraGraphics(not States.Ultra); ToggleVisual(s, States.Ultra, "Ultra HD: ON", "Ultra HD: OFF") end)
MakeBtn(PageMain, "CPU Booster: OFF", function(s) ToggleBoost(not States.Boost); ToggleVisual(s, States.Boost, "CPU Booster: ON", "CPU Booster: OFF") end)
MakeBtn(PageMain, "Water Walk: OFF", function(s) SetWoW(not States.WoW); ToggleVisual(s, States.WoW, "Water Walk: ON", "Water Walk: OFF") end)
MakeBtn(PageMain, "Freeze: OFF", function(s) States.Freeze = not States.Freeze; if HRP then HRP.Anchored = States.Freeze end; ToggleVisual(s, States.Freeze, "Freeze: ON", "Freeze: OFF") end)
MakeBtn(PageMain, "No Clip: OFF", function(s) 
    States.Noclip = not States.Noclip
    ToggleVisual(s, States.Noclip, "No Clip: ON", "No Clip: OFF")
    if States.Noclip then
        Connections["Noclip"] = Services.RunService.Stepped:Connect(function()
            if Player.Character then for _,v in pairs(Player.Character:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide=false end end end
        end)
    else if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end end
end)

-- [[ PAGE MISC ]]
-- Anti Stuck
local StuckCont = Instance.new("Frame", PageMisc); StuckCont.BackgroundTransparency=1
local StuckBtn = Instance.new("TextButton", StuckCont); StuckBtn.Size=UDim2.new(0.65,-4,1,0); StuckBtn.BackgroundColor3=Color3.new(0,0,0); StuckBtn.BackgroundTransparency=0.5; StuckBtn.TextColor3=UI_THEME.TextColor; StuckBtn.Text="Anti-Stuck: OFF"; StuckBtn.Font=UI_THEME.BtnFont; StuckBtn.TextSize=9; Instance.new("UICorner",StuckBtn).CornerRadius=UDim.new(0,4)
local StuckInput = Instance.new("TextBox", StuckCont); StuckInput.Size=UDim2.new(0.35,0,1,0); StuckInput.Position=UDim2.new(0.65,0,0,0); StuckInput.BackgroundColor3=Color3.new(0,0,0); StuckInput.BackgroundTransparency=0.5; StuckInput.TextColor3=UI_THEME.Accent; StuckInput.Text="60"; Instance.new("UICorner",StuckInput).CornerRadius=UDim.new(0,4)

StuckBtn.MouseButton1Click:Connect(function()
    States.AntiStuck = not States.AntiStuck
    if States.AntiStuck then StuckBtn.Text="Anti-Stuck: ON"; StuckBtn.BackgroundColor3=UI_THEME.Accent; StuckBtn.TextColor3=Color3.new(0,0,0)
    else StuckBtn.Text="Anti-Stuck: OFF"; StuckBtn.BackgroundColor3=Color3.new(0,0,0); StuckBtn.TextColor3=UI_THEME.TextColor end
end)
StuckInput.FocusLost:Connect(function() local n=tonumber(StuckInput.Text); if n then States.StuckTimeout=n end end)

MakeBtn(PageMisc, "Save Pos", function(s) if HRP then SavedCFrame=HRP.CFrame; Notify("POS", "Saved!", UI_THEME.Accent) end end)
MakeBtn(PageMisc, "Load Pos", function(s) if HRP and SavedCFrame then HRP.CFrame=SavedCFrame; Notify("POS", "Loaded!", UI_THEME.Accent) end end)
MakeBtn(PageMisc, "Rejoin", function() Services.TeleportService:Teleport(game.PlaceId, Player) end)
MakeBtn(PageMisc, "Panel Info: ON", function(s) States.Panel = not States.Panel; FloatHUD.Visible = States.Panel; ToggleVisual(s, States.Panel, "Panel Info: ON", "Panel Info: OFF") end)
ToggleVisual(PageMisc:GetChildren()[#PageMisc:GetChildren()], true) -- Visually Toggle ON Panel Info button

-- ====================================================
-- [BACKGROUND LOOPS]
-- ====================================================

-- 1. Auto Event Loop
task.spawn(function()
    while true do
        task.wait(3)
        if States.AutoEvent then
            pcall(function()
                if not HRP then return end
                local Props = Services.Workspace:FindFirstChild("Props")
                local Found = nil
                if Props then for _,v in pairs(Props:GetChildren()) do if v:IsA("Model") then Found=v; break end end end
                if Found then
                    if not IsInEvent then EventStartCFrame = HRP.CFrame; IsInEvent = true; Notify("EVENT", "Teleporting...", Color3.fromRGB(255,255,0)) end
                    local dest = Found:GetPivot().Position
                    if (HRP.Position - dest).Magnitude > 10 then HRP.CFrame = CFrame.new(Vector3.new(dest.X, 3, dest.Z)) end
                    if not States.WoW then SetWoW(true) end
                else
                    if IsInEvent then IsInEvent=false; Notify("EVENT", "Finished", Color3.fromRGB(0,255,100)); if EventStartCFrame then HRP.CFrame=EventStartCFrame end; SetWoW(false) end
                end
            end)
        end
    end
end)

-- 2. Anti Stuck Loop
task.spawn(function()
    while true do
        task.wait(1)
        if States.AntiStuck then
            local ls = Player:FindFirstChild("leaderstats")
            local cur = (ls and ls:FindFirstChild("Caught")) and ls.Caught.Value or 0
            if cur > LastFishCount then
                LastFishCount = cur; LastFishCaughtTime = tick()
            else
                if (tick() - LastFishCaughtTime) > States.StuckTimeout then
                    Notify("STUCK", "Respawning...", Color3.fromRGB(255,50,50))
                    local pos = HRP.CFrame
                    if Hum then Hum.Health = 0 end
                    Player.CharacterAdded:Wait()
                    task.wait(1)
                    local newChar = Player.Character or Player.CharacterAdded:Wait()
                    local newHRP = newChar:WaitForChild("HumanoidRootPart", 10)
                    if newHRP then newHRP.CFrame = pos end
                    task.wait(0.5); ForceEquipRod()
                    LastFishCaughtTime = tick(); LastFishCount = cur
                end
            end
        else
            LastFishCaughtTime = tick()
        end
    end
end)

-- 3. Auto Clean Loop
task.spawn(function()
    while true do
        task.wait(10)
        if States.AutoClean then
            pcall(function()
                collectgarbage("collect")
                for _, v in pairs(Services.Workspace:GetDescendants()) do
                    if v:IsA("ParticleEmitter") or v:IsA("Trail") then v:Destroy() end
                end
            end)
        end
    end
end)

-- 4. Auto Equip Loop
task.spawn(function()
    while true do task.wait(2); if States.AutoEquip then ForceEquipRod() end end
end)

-- 5. Stats Update Loop
task.spawn(function()
    while true do
        task.wait(1)
        if States.Panel then
            pcall(function()
                local ls = Player:FindFirstChild("leaderstats")
                LblFishVal.Text = tostring(ls and ls.Caught.Value or 0)
                local bp = Player:FindFirstChild("Backpack")
                LblInvVal.Text = bp and tostring(#bp:GetChildren()) or "0"
            end)
        end
    end
end)

-- 6. FPS Update
local fpsT = 0
Services.RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1
    Title.Text = string.format("SERA HELPER <font size=\"9\" color=\"rgb(180,180,180)\">By @828_raka</font> | FPS: <b>%d</b>", math.floor(fpsT))
end)

Main.Visible = true
FloatHUD.Visible = true

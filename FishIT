--[[ 
    SERAPHIN HELPER - FIXED VERSION (Safe Mode)
    Updated by: r
    Fixes: UI Not Showing (Parenting Issue), Game Loading Check
]]

-- [1] Safe Loading (Tunggu Game Sampai Benar-benar Load)
if not game:IsLoaded() then 
    game.Loaded:Wait() 
end

-- [2] Universal Parent Logic (Otomatis cari tempat agar UI Muncul)
local function GetSafeParent()
    -- Coba gunakan gethui() (Standar executor modern/mobile)
    if gethui then return gethui() end
    
    -- Coba CoreGui (Executor PC lama)
    local Success, Core = pcall(function() return game:GetService("CoreGui") end)
    if Success and Core then return Core end
    
    -- Opsi Terakhir: PlayerGui (Paling aman, pasti muncul)
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
    return LocalPlayer:WaitForChild("PlayerGui")
end

local TargetParent = GetSafeParent()
print("UI Parenting to: " .. tostring(TargetParent)) -- Cek Console (F9) jika masih gagal

-- [3] Services & Variables
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    GuiService = game:GetService("GuiService"),
    HttpService = game:GetService("HttpService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    Lighting = game:GetService("Lighting")
}

local Player = Services.Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart", 10)
local Hum = Char:WaitForChild("Humanoid", 10)

Player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    HRP = newChar:WaitForChild("HumanoidRootPart", 10)
    Hum = newChar:WaitForChild("Humanoid", 10)
end)

-- // KONFIGURASI TEMA MODERN //
local UI_THEME = {
    MainColor = Color3.fromRGB(25, 25, 30),
    SidebarColor = Color3.fromRGB(35, 35, 40),
    Accent = Color3.fromRGB(0, 200, 255),
    TextWhite = Color3.fromRGB(240, 240, 240),
    TextGray = Color3.fromRGB(150, 150, 150),
    FontBold = Enum.Font.GothamBlack,
    FontReg = Enum.Font.GothamMedium,
    Corner = 6
}

-- Bersihkan UI Lama (Cek di semua kemungkinan parent)
pcall(function()
    if TargetParent:FindFirstChild("SeraphinHelper") then TargetParent.SeraphinHelper:Destroy() end
    if game:GetService("CoreGui"):FindFirstChild("SeraphinHelper") then game:GetService("CoreGui").SeraphinHelper:Destroy() end
    if Player.PlayerGui:FindFirstChild("SeraphinHelper") then Player.PlayerGui.SeraphinHelper:Destroy() end
end)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = TargetParent
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true -- Agar tidak terpotong header Roblox

-- [4] CUSTOM NOTIFICATION SYSTEM
local NotifContainer = Instance.new("Frame", ScreenGui)
NotifContainer.Name = "Notifications"
NotifContainer.Size = UDim2.new(0, 300, 1, 0)
NotifContainer.Position = UDim2.new(1, -320, 0, 50)
NotifContainer.BackgroundTransparency = 1

local NotifList = Instance.new("UIListLayout", NotifContainer)
NotifList.SortOrder = Enum.SortOrder.LayoutOrder
NotifList.Padding = UDim.new(0, 10)
NotifList.VerticalAlignment = Enum.VerticalAlignment.Bottom

local function Notify(title, text, duration)
    local Frame = Instance.new("Frame", NotifContainer)
    Frame.Size = UDim2.new(1, 0, 0, 60)
    Frame.BackgroundColor3 = UI_THEME.MainColor
    Frame.BorderSizePixel = 0
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 4)
    
    local Bar = Instance.new("Frame", Frame)
    Bar.Size = UDim2.new(0, 6, 1, 0)
    Bar.BackgroundColor3 = UI_THEME.Accent
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(0, 4)
    
    local TitleLbl = Instance.new("TextLabel", Frame)
    TitleLbl.Position = UDim2.new(0, 15, 0, 5)
    TitleLbl.Size = UDim2.new(1, -20, 0, 25)
    TitleLbl.BackgroundTransparency = 1
    TitleLbl.Text = title
    TitleLbl.TextColor3 = UI_THEME.Accent
    TitleLbl.Font = UI_THEME.FontBold
    TitleLbl.TextSize = 14
    TitleLbl.TextXAlignment = Enum.TextXAlignment.Left
    
    local DescLbl = Instance.new("TextLabel", Frame)
    DescLbl.Position = UDim2.new(0, 15, 0, 25)
    DescLbl.Size = UDim2.new(1, -20, 0, 30)
    DescLbl.BackgroundTransparency = 1
    DescLbl.Text = text
    DescLbl.TextColor3 = UI_THEME.TextWhite
    DescLbl.Font = UI_THEME.FontReg
    DescLbl.TextSize = 12
    DescLbl.TextXAlignment = Enum.TextXAlignment.Left
    DescLbl.TextWrapped = true

    Frame.BackgroundTransparency = 1
    TitleLbl.TextTransparency = 1
    DescLbl.TextTransparency = 1
    Bar.BackgroundTransparency = 1
    
    Services.TweenService:Create(Frame, TweenInfo.new(0.3), {BackgroundTransparency = 0.1}):Play()
    Services.TweenService:Create(Bar, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
    Services.TweenService:Create(TitleLbl, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
    Services.TweenService:Create(DescLbl, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
    
    task.delay(duration or 3, function()
        pcall(function()
            Services.TweenService:Create(Frame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
            Services.TweenService:Create(Bar, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
            Services.TweenService:Create(TitleLbl, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
            Services.TweenService:Create(DescLbl, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
            task.wait(0.5)
            Frame:Destroy()
        end)
    end)
end

Notify("Welcome", "Seraphin Helper V2 (Fixed)", 4)

-- [5] MAIN UI STRUCTURE
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "MainFrame"
Main.Size = UDim2.new(0, 550, 0, 320)
Main.Position = UDim2.new(0.5, -275, 0.5, -160)
Main.BackgroundColor3 = UI_THEME.MainColor
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Main.Visible = true -- Pastikan Visible
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, UI_THEME.Corner)

local Shadow = Instance.new("UIStroke", Main)
Shadow.Color = UI_THEME.SidebarColor
Shadow.Thickness = 2

-- SIDEBAR
local Sidebar = Instance.new("Frame", Main)
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 130, 1, 0)
Sidebar.BackgroundColor3 = UI_THEME.SidebarColor
Sidebar.BorderSizePixel = 0
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, UI_THEME.Corner)

local SidebarList = Instance.new("UIListLayout", Sidebar)
SidebarList.SortOrder = Enum.SortOrder.LayoutOrder
SidebarList.Padding = UDim.new(0, 5)
SidebarList.HorizontalAlignment = Enum.HorizontalAlignment.Center

local SidebarPad = Instance.new("UIPadding", Sidebar)
SidebarPad.PaddingTop = UDim.new(0, 15)

-- Sidebar Title
local SBTitle = Instance.new("TextLabel", Sidebar)
SBTitle.Size = UDim2.new(1, 0, 0, 30)
SBTitle.BackgroundTransparency = 1
SBTitle.Text = "SERAPHIN"
SBTitle.TextColor3 = UI_THEME.Accent
SBTitle.Font = UI_THEME.FontBold
SBTitle.TextSize = 16
SBTitle.LayoutOrder = 0

local SBSub = Instance.new("TextLabel", Sidebar)
SBSub.Size = UDim2.new(1, 0, 0, 15)
SBSub.BackgroundTransparency = 1
SBSub.Text = "HELPER"
SBSub.TextColor3 = UI_THEME.TextWhite
SBSub.Font = UI_THEME.FontBold
SBSub.TextSize = 14
SBSub.LayoutOrder = 1

local Div = Instance.new("Frame", Sidebar)
Div.Size = UDim2.new(0.8, 0, 0, 1)
Div.BackgroundColor3 = UI_THEME.TextGray
Div.BackgroundTransparency = 0.8
Div.LayoutOrder = 2

-- PAGE CONTAINER
local PageContainer = Instance.new("Frame", Main)
PageContainer.Name = "Pages"
PageContainer.Size = UDim2.new(1, -140, 1, -10)
PageContainer.Position = UDim2.new(0, 135, 0, 5)
PageContainer.BackgroundTransparency = 1

local Pages = {} 

-- [FUNCTION] Create Tab Button
local function CreateTab(name, pageFrame)
    local Btn = Instance.new("TextButton", Sidebar)
    Btn.Name = name.."Btn"
    Btn.Size = UDim2.new(0.9, 0, 0, 35)
    Btn.BackgroundColor3 = UI_THEME.MainColor
    Btn.BackgroundTransparency = 1
    Btn.Text = name
    Btn.TextColor3 = UI_THEME.TextGray
    Btn.Font = UI_THEME.FontReg
    Btn.TextSize = 12
    Btn.LayoutOrder = 10
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
    
    Btn.MouseButton1Click:Connect(function()
        for _, p in pairs(Pages) do p.Visible = false end
        pageFrame.Visible = true
        
        for _, child in pairs(Sidebar:GetChildren()) do
            if child:IsA("TextButton") then
                Services.TweenService:Create(child, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextColor3 = UI_THEME.TextGray}):Play()
            end
        end
        Services.TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundTransparency = 0, TextColor3 = UI_THEME.Accent}):Play()
    end)
    return Btn
end

-- [FUNCTION] Make Pages
local function MakePage(name)
    local P = Instance.new("Frame", PageContainer)
    P.Name = name
    P.Size = UDim2.new(1, 0, 1, 0)
    P.BackgroundTransparency = 1
    P.Visible = false
    table.insert(Pages, P)
    
    local Scroll = Instance.new("ScrollingFrame", P)
    Scroll.Size = UDim2.new(1, 0, 1, 0)
    Scroll.BackgroundTransparency = 1
    Scroll.ScrollBarThickness = 2
    Scroll.ScrollBarImageColor3 = UI_THEME.Accent
    Scroll.BorderSizePixel = 0
    
    local Layout = Instance.new("UIGridLayout", Scroll)
    Layout.CellSize = UDim2.new(0, 125, 0, 40)
    Layout.CellPadding = UDim2.new(0, 10, 0, 10)
    Layout.SortOrder = Enum.SortOrder.LayoutOrder
    
    local Pad = Instance.new("UIPadding", Scroll)
    Pad.PaddingTop = UDim.new(0, 10)
    Pad.PaddingLeft = UDim.new(0, 5)
    
    return P, Scroll, Layout
end

local PageMain, ScrollMain = MakePage("Main")
local PageMisc, ScrollMisc, LayoutMisc = MakePage("Misc")
local PageHook, ScrollHook, LayoutHook = MakePage("Webhook")

LayoutHook.CellSize = UDim2.new(0.95, 0, 0, 40) 
LayoutMisc.CellSize = UDim2.new(0.95, 0, 0, 40)

local Tab1 = CreateTab("MAIN", PageMain)
local Tab2 = CreateTab("MISC", PageMisc)
local Tab3 = CreateTab("WEBHOOK", PageHook)

PageMain.Visible = true
Services.TweenService:Create(Tab1, TweenInfo.new(0.2), {BackgroundTransparency = 0, TextColor3 = UI_THEME.Accent}):Play()

-- [FUNCTION] Create Buttons & Sliders
local function CreateButton(parent, text, callback)
    local Btn = Instance.new("TextButton", parent)
    Btn.Text = ""
    Btn.BackgroundColor3 = UI_THEME.SidebarColor
    Btn.TextColor3 = UI_THEME.TextWhite
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 4)
    
    local Lbl = Instance.new("TextLabel", Btn)
    Lbl.Size = UDim2.new(1, 0, 1, 0)
    Lbl.BackgroundTransparency = 1
    Lbl.Text = text
    Lbl.TextColor3 = UI_THEME.TextWhite
    Lbl.Font = UI_THEME.FontReg
    Lbl.TextSize = 11
    
    local Stroke = Instance.new("UIStroke", Btn)
    Stroke.Color = UI_THEME.Accent
    Stroke.Transparency = 0.7
    Stroke.Thickness = 1
    
    local toggled = false
    Btn.MouseButton1Click:Connect(function()
        toggled = not toggled
        if toggled then
            Services.TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = UI_THEME.Accent}):Play()
            Services.TweenService:Create(Stroke, TweenInfo.new(0.2), {Transparency = 1}):Play()
            Lbl.TextColor3 = Color3.new(0,0,0)
            Lbl.Font = UI_THEME.FontBold
        else
            Services.TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = UI_THEME.SidebarColor}):Play()
            Services.TweenService:Create(Stroke, TweenInfo.new(0.2), {Transparency = 0.7}):Play()
            Lbl.TextColor3 = UI_THEME.TextWhite
            Lbl.Font = UI_THEME.FontReg
        end
        callback(toggled, Btn, Lbl)
    end)
    return Btn
end

local function CreateSlider(parent, text, min, max, default, callback)
    local Frame = Instance.new("Frame", parent)
    Frame.BackgroundColor3 = UI_THEME.SidebarColor
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 4)
    
    local Title = Instance.new("TextLabel", Frame)
    Title.Position = UDim2.new(0, 10, 0, 5)
    Title.Size = UDim2.new(1, -20, 0, 15)
    Title.BackgroundTransparency = 1
    Title.Text = text
    Title.TextColor3 = UI_THEME.TextWhite
    Title.Font = UI_THEME.FontBold
    Title.TextSize = 11
    Title.TextXAlignment = Enum.TextXAlignment.Left
    
    local ValLbl = Instance.new("TextLabel", Frame)
    ValLbl.Position = UDim2.new(1, -60, 0, 5)
    ValLbl.Size = UDim2.new(0, 50, 0, 15)
    ValLbl.BackgroundTransparency = 1
    ValLbl.Text = default .. "s"
    ValLbl.TextColor3 = UI_THEME.Accent
    ValLbl.Font = UI_THEME.FontBold
    ValLbl.TextSize = 11
    ValLbl.TextXAlignment = Enum.TextXAlignment.Right
    
    local SlideBg = Instance.new("TextButton", Frame)
    SlideBg.Position = UDim2.new(0, 10, 0, 25)
    SlideBg.Size = UDim2.new(1, -20, 0, 6)
    SlideBg.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    SlideBg.Text = ""
    SlideBg.AutoButtonColor = false
    Instance.new("UICorner", SlideBg).CornerRadius = UDim.new(1, 0)
    
    local Fill = Instance.new("Frame", SlideBg)
    Fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    Fill.BackgroundColor3 = UI_THEME.Accent
    Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)
    
    local dragging = false
    local function update(input)
        local SizeX = math.clamp((input.Position.X - SlideBg.AbsolutePosition.X) / SlideBg.AbsoluteSize.X, 0, 1)
        Fill.Size = UDim2.new(SizeX, 0, 1, 0)
        local value = math.floor(min + ((max - min) * SizeX))
        ValLbl.Text = value .. "s"
        callback(value)
    end
    
    SlideBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = true; update(input) end
    end)
    
    Services.UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then update(input) end
    end)
    
    Services.UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = false end
    end)
    return Frame
end

-- ====================================================
-- [STATES & LOGIC]
-- ====================================================
local States = {
    Freeze=false, WoW=false, Boost=false, NoRender=false, 
    Noclip=false, AutoEquip=false, AutoEvent=false, 
    AntiStuck=false, StuckTimeout=60, WebhookEnabled=false, WebhookUrl=""
}
local Connections = {}
local BodyV = nil
local IsInEvent = false
local EventStartCFrame = nil
local LastFishCaughtTime = tick()
local LastFishCount = 0

-- Drag Function
local function EnableDrag(frame)
    local dragToggle, dragStart, startPos
    local function updateInput(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    frame.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true; dragStart = input.Position; startPos = frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            if dragToggle then updateInput(input) end
        end
    end)
end
EnableDrag(Main)

-- Logic Functions
local function SetWoW(bool)
    States.WoW = bool
    if bool then
        if not HRP then return end
        if not BodyV then 
            BodyV = Instance.new("BodyVelocity")
            BodyV.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            BodyV.Velocity = Vector3.zero
            BodyV.Parent = HRP
        end
        Connections["WoW"] = Services.RunService.RenderStepped:Connect(function()
            if HRP and Hum and BodyV and BodyV.Parent then
                local moveDir = Hum.MoveDirection
                local speed = Hum.WalkSpeed
                if moveDir.Magnitude > 0 then
                    BodyV.Velocity = Vector3.new(moveDir.X * speed, 0, moveDir.Z * speed)
                else
                    BodyV.Velocity = Vector3.zero
                end
            end
        end)
    else
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end
        if BodyV then BodyV:Destroy(); BodyV = nil end
    end
end

local function ForceEquipRod()
    pcall(function()
        local pkgs = Services.ReplicatedStorage:FindFirstChild("Packages")
        if pkgs then
            local idx = pkgs:FindFirstChild("_Index")
            if idx and idx:FindFirstChild("sleitnick_net@0.2.0") then
                idx["sleitnick_net@0.2.0"].net["RE/EquipToolFromHotbar"]:FireServer(1)
            end
        end
    end)
end

-- ====================================================
-- [BUTTON MAPPING]
-- ====================================================

-- Page Main
CreateButton(ScrollMain, "Auto Event", function(state, btn, lbl) States.AutoEvent = state; lbl.Text="Auto Event: "..(state and "ON" or "OFF"); if not state then IsInEvent=false; SetWoW(false); if EventStartCFrame and HRP then HRP.CFrame=EventStartCFrame end end end)
CreateButton(ScrollMain, "Auto Equip", function(state, btn, lbl) States.AutoEquip = state; lbl.Text="Auto Equip: "..(state and "ON" or "OFF") end)
CreateButton(ScrollMain, "Water Walk", function(state, btn, lbl) SetWoW(state); lbl.Text="Water Walk: "..(state and "ON" or "OFF") end)
CreateButton(ScrollMain, "Freeze Pos", function(state, btn, lbl) States.Freeze = state; if HRP then HRP.Anchored = state end; lbl.Text="Freeze: "..(state and "ON" or "OFF") end)
CreateButton(ScrollMain, "No Clip", function(state, btn, lbl) States.Noclip = state; lbl.Text="No Clip: "..(state and "ON" or "OFF"); if state then Connections["Noclip"] = Services.RunService.Stepped:Connect(function() if Player.Character then for _,v in pairs(Player.Character:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide=false end end end end) else if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end end end)
CreateButton(ScrollMain, "FPS Cap", function(state, btn, lbl) if setfpscap then setfpscap(state and 9999 or 60) end; lbl.Text="FPS Unlock: "..(state and "MAX" or "60") end)

-- Page Misc
CreateButton(ScrollMisc, "Toggle Anti-Stuck", function(state, btn, lbl) States.AntiStuck = state; lbl.Text="Anti-Stuck: "..(state and "ON" or "OFF"); LastFishCaughtTime = tick() end)
CreateSlider(ScrollMisc, "Stuck Timeout", 1, 120, 60, function(val) States.StuckTimeout = val end)
CreateButton(ScrollMisc, "Save Pos", function(state, btn, lbl) if HRP then EventStartCFrame = HRP.CFrame; Notify("Info","Position Saved",2) end end)
CreateButton(ScrollMisc, "Load Pos", function(state, btn, lbl) if EventStartCFrame and HRP then HRP.CFrame = EventStartCFrame; Notify("Info","Position Loaded",2) end end)
CreateButton(ScrollMisc, "Rejoin", function() Services.TeleportService:Teleport(game.PlaceId, Player) end)

-- Page Webhook
local WhInput = Instance.new("TextBox", ScrollHook)
WhInput.Size = UDim2.new(0.95, 0, 0, 35)
WhInput.BackgroundColor3 = UI_THEME.SidebarColor
WhInput.TextColor3 = UI_THEME.Accent
WhInput.PlaceholderText = "Paste Webhook URL..."
WhInput.TextSize = 10
Instance.new("UICorner", WhInput).CornerRadius = UDim.new(0, 4)
WhInput.FocusLost:Connect(function() States.WebhookUrl = WhInput.Text end)

CreateButton(ScrollHook, "Test Webhook", function() 
    if States.WebhookUrl == "" then Notify("Error","Empty URL",2) return end
    local req = http_request or request or HttpPost or syn.request
    if req then req({Url=States.WebhookUrl, Body=Services.HttpService:JSONEncode({content="Test Webhook Success!"}), Method="POST", Headers={["Content-Type"]="application/json"}}) end
end)
CreateButton(ScrollHook, "DC Notify", function(state, btn, lbl) States.WebhookEnabled = state; lbl.Text="DC Notify: "..(state and "ON" or "OFF") end)

-- ====================================================
-- [LOOPS]
-- ====================================================

-- Float HUD
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Size = UDim2.new(0, 150, 0, 60)
FloatHUD.Position = UDim2.new(0.02, 0, 0.4, 0)
FloatHUD.BackgroundColor3 = UI_THEME.MainColor
FloatHUD.BackgroundTransparency = 0.2
Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", FloatHUD).Color = UI_THEME.Accent
EnableDrag(FloatHUD)

local LblFPS = Instance.new("TextLabel", FloatHUD)
LblFPS.Size = UDim2.new(1, 0, 0.5, 0)
LblFPS.BackgroundTransparency = 1
LblFPS.Text = "FPS: 60"
LblFPS.TextColor3 = UI_THEME.Accent
LblFPS.Font = UI_THEME.FontBold
LblFPS.TextSize = 18

local LblFish = Instance.new("TextLabel", FloatHUD)
LblFish.Position = UDim2.new(0, 0, 0.5, 0)
LblFish.Size = UDim2.new(1, 0, 0.5, 0)
LblFish.BackgroundTransparency = 1
LblFish.Text = "Fish: 0"
LblFish.TextColor3 = UI_THEME.TextWhite
LblFish.Font = UI_THEME.FontReg
LblFish.TextSize = 14

-- FPS Loop
local fpsT = 0
Services.RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1
    LblFPS.Text = "FPS: " .. math.floor(fpsT)
end)

-- Fish Loop
task.spawn(function()
    while true do
        task.wait(1)
        pcall(function()
            local ls = Player:FindFirstChild("leaderstats")
            if ls and ls:FindFirstChild("Caught") then LblFish.Text = "Fish: " .. ls.Caught.Value end
        end)
    end
end)

-- Auto Event
task.spawn(function()
    while true do
        task.wait(1.5)
        if States.AutoEvent then
            pcall(function()
                local Props = Services.Workspace:FindFirstChild("Props")
                local FoundEvent = nil
                if Props then for _, v in pairs(Props:GetChildren()) do if v:IsA("Model") or v:IsA("BasePart") then FoundEvent = v; break end end end
                
                if FoundEvent then
                    if not IsInEvent then EventStartCFrame = HRP.CFrame; IsInEvent = true; Notify("Event","Started!",2) end
                    local t = FoundEvent:GetPivot().Position
                    if (HRP.Position - t).Magnitude > 15 then HRP.CFrame = CFrame.new(t.X, t.Y+3, t.Z) end
                    if not States.WoW then SetWoW(true) end
                else
                    if IsInEvent then IsInEvent=false; Notify("Event","Ended",2); if EventStartCFrame then HRP.CFrame=EventStartCFrame end; SetWoW(false) end
                end
            end)
        end
    end
end)

-- Anti Stuck & Auto Equip
task.spawn(function()
    while true do
        task.wait(1)
        if States.AutoEquip then ForceEquipRod() end
        if States.AntiStuck then
            pcall(function()
                local ls = Player:FindFirstChild("leaderstats")
                local cur = (ls and ls:FindFirstChild("Caught")) and ls.Caught.Value or 0
                if cur > LastFishCount then LastFishCount=cur; LastFishCaughtTime=tick()
                else
                    if (tick()-LastFishCaughtTime) > States.StuckTimeout then
                        Notify("Stuck","Respawning...",3)
                        local oldPos = HRP.CFrame
                        if Hum then Hum.Health=0 end
                        Player.CharacterAdded:Wait()
                        Char = Player.Character or Player.CharacterAdded:Wait()
                        HRP = Char:WaitForChild("HumanoidRootPart")
                        Hum = Char:WaitForChild("Humanoid")
                        task.wait(1)
                        HRP.CFrame = oldPos
                        LastFishCaughtTime=tick()
                    end
                end
            end)
        else
            LastFishCaughtTime=tick()
        end
    end
end)

-- Webhook Disconnect
Services.GuiService.ErrorMessageChanged:Connect(function()
    if States.WebhookEnabled and States.WebhookUrl ~= "" then
        local err = Services.GuiService:GetErrorMessage()
        if err and err ~= "" then
            local req = http_request or request or HttpPost or syn.request
            if req then req({Url=States.WebhookUrl, Body=Services.HttpService:JSONEncode({content="@everyone DC!", embeds={{title="Disconnect", description=err, color=16711680}}}), Method="POST", Headers={["Content-Type"]="application/json"}}) end
        end
    end
end)

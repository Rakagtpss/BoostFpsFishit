-- [1] Notifikasi Awal
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Raka Ganteng",
        Text = "Update: Auto Weather + Dropdown UI",
        Duration = 2,
    })
end)

task.wait(2)

-- [2] Variable & Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage") 
local VirtualInputManager = game:GetService("VirtualInputManager") 

local Player = Players.LocalPlayer
local Char = Player.Character or Player.CharacterAdded:Wait()

-- // DEFINE REMOTES
local net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
local ChargeRod    = net["RF/ChargeFishingRod"]
local RequestGame  = net["RF/RequestFishingMinigameStarted"]
local CompleteGame = net["RE/FishingCompleted"]
local CancelInput  = net["RF/CancelFishingInputs"]

-- [UPDATED] PATH KHUSUS SESUAI REQUEST
local SellItemRemote = net:FindFirstChild("RF/SellItem") 

-- [NEW] PATH WEATHER (Otomatis cari atau edit manual disini)
-- Biasanya namanya "RF/PurchaseWeather" atau "RF/WorldEvent"
local WeatherRemote = net:FindFirstChild("RF/PurchaseWeather") or net:FindFirstChild("RF/WeatherTotem") 

-- // KONFIGURASI GLOBAL
getgenv().fishingStart = false
_G.FishSettings = { DelayCharge = 0, DelayReset = 0 }
_G.SellSettings = { Interval = 600, NextSellTime = os.time() + 600 }
_G.WeatherSettings = { 
    Active = false, 
    Selected = {}, -- List cuaca yang dipilih
    Interval = 15  -- Cek setiap 15 detik
}

local fishArgs = { -1.115296483039856, 0, 1763651451.636425 }

-- =====================================================
-- ðŸŽ£ FUNGSI LOOP FISHING
-- =====================================================
local function startFishingHyperLoop()
    pcall(function() CancelInput:InvokeServer() end)
    game:GetService("RunService").Heartbeat:Wait()
    while getgenv().fishingStart do
        task.spawn(function() pcall(function() ChargeRod:InvokeServer() end) end)
        task.spawn(function() pcall(function() RequestGame:InvokeServer(unpack(fishArgs)) end) end)
        if _G.FishSettings.DelayCharge > 0 then task.wait(_G.FishSettings.DelayCharge) else game:GetService("RunService").Heartbeat:Wait() end
        if not getgenv().fishingStart then break end
        pcall(function() CompleteGame:FireServer() end)
        if _G.FishSettings.DelayReset > 0 then task.wait(_G.FishSettings.DelayReset) end
        task.spawn(function() pcall(function() CancelInput:InvokeServer() end) end)
    end
end

-- // UI THEME (DARK FIRE)
local UI_THEME = {
    MinWidth = 280, MinHeight = 350, Color = Color3.fromRGB(8, 8, 8), Transparency = 0.25,
    HeaderColor = Color3.fromRGB(20, 15, 15), Accent = Color3.fromRGB(255, 69, 0),
    TabOff = Color3.fromRGB(120, 120, 120), TabOn = Color3.fromRGB(255, 165, 0),
    TextColor = Color3.fromRGB(255, 245, 230), BtnFont = Enum.Font.GothamMedium 
}

if CoreGui:FindFirstChild("SeraphinHelper") then CoreGui.SeraphinHelper:Destroy() end
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "SeraphinHelper"

-- [UI BUILDER HELPERS]
local function MakeBtn(parent, text)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(5, 5, 5); b.BackgroundTransparency = 0.4
    b.TextColor3 = Color3.fromRGB(200, 200, 200); b.Font = UI_THEME.BtnFont; b.TextSize = 10 
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    local s = Instance.new("UIStroke", b); s.Color = Color3.fromRGB(60, 40, 40); s.Transparency = 0.5
    return b
end

local function MakeInput(parent, placeholder, default)
    local b = Instance.new("TextBox", parent)
    b.PlaceholderText = placeholder; b.Text = default
    b.BackgroundColor3 = Color3.fromRGB(15, 10, 10); b.BackgroundTransparency = 0.4
    b.TextColor3 = UI_THEME.Accent; b.Font = UI_THEME.BtnFont; b.TextSize = 10 
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    local s = Instance.new("UIStroke", b); s.Color = Color3.fromRGB(60, 40, 40); s.Transparency = 0.5
    return b
end

local function ToggleVisual(btn, on)
    if on then
        btn.BackgroundColor3 = UI_THEME.Accent; btn.BackgroundTransparency = 0.2
        btn.TextColor3 = Color3.fromRGB(10, 5, 5); btn.UIStroke.Transparency = 1
    else
        btn.BackgroundColor3 = Color3.fromRGB(5, 5, 5); btn.BackgroundTransparency = 0.4
        btn.TextColor3 = Color3.fromRGB(200, 200, 200); btn.UIStroke.Transparency = 0.5
    end
end

local function Notify(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", { Title = title, Text = text, Duration = 3 })
end

-- [NEW] CUSTOM DROPDOWN FUNCTION
local function MakeDropdown(parent, title, options)
    local frame = Instance.new("Frame", parent)
    frame.Size = UDim2.new(1, 0, 0, 28); frame.BackgroundTransparency = 1
    
    local mainBtn = MakeBtn(frame, title .. " â–¼")
    mainBtn.Size = UDim2.new(1, 0, 0, 28)
    
    local listFrame = Instance.new("Frame", parent) -- Taruh di parent agar tidak ketimpa layout
    listFrame.Size = UDim2.new(1, 0, 0, #options * 25)
    listFrame.BackgroundColor3 = Color3.fromRGB(15,15,15)
    listFrame.Visible = false
    listFrame.ZIndex = 10
    Instance.new("UIListLayout", listFrame)
    
    local open = false
    mainBtn.MouseButton1Click:Connect(function()
        open = not open
        listFrame.Visible = open
        mainBtn.Text = title .. (open and " â–²" or " â–¼")
    end)
    
    -- Buat Tombol Opsi
    for _, optName in ipairs(options) do
        local optBtn = Instance.new("TextButton", listFrame)
        optBtn.Size = UDim2.new(1, 0, 0, 25)
        optBtn.BackgroundColor3 = Color3.fromRGB(10,10,10)
        optBtn.TextColor3 = Color3.fromRGB(150,150,150)
        optBtn.Text = optName
        optBtn.Font = UI_THEME.BtnFont
        optBtn.TextSize = 10
        
        optBtn.MouseButton1Click:Connect(function()
            -- Logic Multi Select
            if _G.WeatherSettings.Selected[optName] then
                _G.WeatherSettings.Selected[optName] = nil
                optBtn.TextColor3 = Color3.fromRGB(150,150,150)
                optBtn.Text = optName
            else
                _G.WeatherSettings.Selected[optName] = true
                optBtn.TextColor3 = UI_THEME.Accent
                optBtn.Text = "âœ… " .. optName
            end
        end)
    end
    
    return frame, listFrame
end

-- MAIN UI STRUCTURE
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, UI_THEME.MinWidth, 0, UI_THEME.MinHeight + 50)
Main.Position = UDim2.new(0.5, -140, 0.4, 0)
Main.BackgroundColor3 = UI_THEME.Color
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)

local TabHolder = Instance.new("Frame", Main)
TabHolder.Size = UDim2.new(1, 0, 0, 25); TabHolder.Position = UDim2.new(0, 0, 0, 10); TabHolder.BackgroundTransparency = 1
local TabBtnMain = MakeBtn(TabHolder, "MAIN"); TabBtnMain.Size = UDim2.new(0.5, -4, 1, 0); TabBtnMain.Position = UDim2.new(0, 2, 0, 0)
local TabBtnMisc = MakeBtn(TabHolder, "MISC / WEATHER"); TabBtnMisc.Size = UDim2.new(0.5, -4, 1, 0); TabBtnMisc.Position = UDim2.new(0.5, 2, 0, 0)

local PageContainer = Instance.new("Frame", Main)
PageContainer.Size = UDim2.new(1, -16, 1, -50); PageContainer.Position = UDim2.new(0, 8, 0, 40); PageContainer.BackgroundTransparency = 1
local PageMain = Instance.new("Frame", PageContainer); PageMain.Size = UDim2.new(1,0,1,0); PageMain.BackgroundTransparency=1
local PageMisc = Instance.new("ScrollingFrame", PageContainer); PageMisc.Size = UDim2.new(1,0,1,0); PageMisc.BackgroundTransparency=1; PageMisc.Visible=false
PageMisc.ScrollBarThickness = 2

local GridMain = Instance.new("UIGridLayout", PageMain); GridMain.CellSize = UDim2.new(0, 128, 0, 28); GridMain.CellPadding = UDim2.new(0, 8, 0, 6)
local ListMisc = Instance.new("UIListLayout", PageMisc); ListMisc.Padding = UDim.new(0, 6); ListMisc.SortOrder = Enum.SortOrder.LayoutOrder

-- TAB LOGIC
TabBtnMain.MouseButton1Click:Connect(function() PageMain.Visible=true; PageMisc.Visible=false; ToggleVisual(TabBtnMain,true); ToggleVisual(TabBtnMisc,false) end)
TabBtnMisc.MouseButton1Click:Connect(function() PageMain.Visible=false; PageMisc.Visible=true; ToggleVisual(TabBtnMain,false); ToggleVisual(TabBtnMisc,true) end)
ToggleVisual(TabBtnMain, true)

-- [[ ELEMENT HALAMAN MAIN ]]
local BtnAutoFish = MakeBtn(PageMain, "Auto Fish: OFF")
local InputReel = MakeInput(PageMain, "Delay Fishing (0)", "0")
local InputCast = MakeInput(PageMain, "Delay Reset (0)", "0")

BtnAutoFish.MouseButton1Click:Connect(function()
    if getgenv().fishingStart then
        getgenv().fishingStart = false
        BtnAutoFish.Text = "Auto Fish: OFF"; ToggleVisual(BtnAutoFish, false)
        pcall(function() CompleteGame:FireServer() end); pcall(function() CancelInput:InvokeServer() end)
    else
        getgenv().fishingStart = true
        BtnAutoFish.Text = "Auto Fish: ON"; ToggleVisual(BtnAutoFish, true)
        task.spawn(startFishingHyperLoop)
    end
end)

-- [[ ELEMENT HALAMAN MISC (WEATHER & SELL) ]]

-- 1. Auto Sell Section
local LabelSell = Instance.new("TextLabel", PageMisc); LabelSell.Text = "-- AUTO SELL --"; LabelSell.Size = UDim2.new(1,0,0,15); LabelSell.BackgroundTransparency=1; LabelSell.TextColor3=UI_THEME.Accent; LabelSell.LayoutOrder=1
local BtnAutoSell = MakeBtn(PageMisc, "Auto Sell: OFF"); BtnAutoSell.LayoutOrder=2
local InputSell   = MakeInput(PageMisc, "Interval (s) - Default 600", "600"); InputSell.LayoutOrder=3
local BtnSellNow  = MakeBtn(PageMisc, "Sell All Items NOW"); BtnSellNow.LayoutOrder=4

-- 2. Weather Section (NEW)
local LabelWeather = Instance.new("TextLabel", PageMisc); LabelWeather.Text = "-- WEATHER CONTROL --"; LabelWeather.Size = UDim2.new(1,0,0,15); LabelWeather.BackgroundTransparency=1; LabelWeather.TextColor3=UI_THEME.Accent; LabelWeather.LayoutOrder=5

-- Dropdown Cuaca
local DropFrame, DropList = MakeDropdown(PageMisc, "Select Weather(s)", {"Wind", "Cloudy", "Snow", "Storm", "Radiant"})
DropFrame.LayoutOrder = 6
DropList.LayoutOrder = 7 -- List muncul dibawahnya

-- Toggle Smart Monitor
local BtnMonitor = MakeBtn(PageMisc, "Smart Monitor (15s): OFF")
BtnMonitor.LayoutOrder = 8

-- LOGIC AUTO SELL
BtnAutoSell.MouseButton1Click:Connect(function()
    _G.FishSettings.AutoSell = not _G.FishSettings.AutoSell
    BtnAutoSell.Text = "Auto Sell: " .. (_G.FishSettings.AutoSell and "ON" or "OFF")
    ToggleVisual(BtnAutoSell, _G.FishSettings.AutoSell)
end)

BtnSellNow.MouseButton1Click:Connect(function()
    if not SellItemRemote then Notify("Error", "Remote SellItem tidak ditemukan!"); return end
    Notify("Selling", "Mencoba menjual backpack...")
    for _, item in pairs(Player.Backpack:GetChildren()) do
        if item:IsA("Tool") and item.Name ~= "Rod" then
            SellItemRemote:InvokeServer(item)
            task.wait(0.05)
        end
    end
end)

-- LOGIC SMART WEATHER
BtnMonitor.MouseButton1Click:Connect(function()
    _G.WeatherSettings.Active = not _G.WeatherSettings.Active
    BtnMonitor.Text = "Smart Monitor (15s): " .. (_G.WeatherSettings.Active and "ON" or "OFF")
    ToggleVisual(BtnMonitor, _G.WeatherSettings.Active)
    
    if _G.WeatherSettings.Active then
        Notify("Weather", "Monitor Started")
        task.spawn(function()
            while _G.WeatherSettings.Active do
                -- Logic: Cek daftar yang dipilih
                local selectedWeathers = {}
                for name, isActive in pairs(_G.WeatherSettings.Selected) do
                    if isActive then table.insert(selectedWeathers, name) end
                end
                
                if #selectedWeathers > 0 then
                    -- Pilih satu secara acak dari yang dicentang
                    local targetWeather = selectedWeathers[math.random(1, #selectedWeathers)]
                    
                    if WeatherRemote then
                        pcall(function() 
                            -- Sesuaikan argumen ini dengan game aslinya!
                            -- Contoh: WeatherRemote:InvokeServer(targetWeather)
                            WeatherRemote:FireServer(targetWeather) 
                        end)
                        print("Trying to set weather to: " .. targetWeather)
                    else
                        -- Jika remote belum ketemu, print dulu
                        warn("Weather Remote belum di-set di script!")
                    end
                end
                
                task.wait(_G.WeatherSettings.Interval) -- Tunggu 15 detik
            end
        end)
    else
        Notify("Weather", "Monitor Stopped")
    end
end)

-- Input Update
InputSell.FocusLost:Connect(function()
    local n = tonumber(InputSell.Text)
    if n then _G.SellSettings.Interval = n end
end)

-- Auto Sell Loop Backend
task.spawn(function()
    while true do
        task.wait(1)
        if _G.FishSettings.AutoSell and os.time() >= _G.SellSettings.NextSellTime then
            local wasFish = getgenv().fishingStart
            if wasFish then getgenv().fishingStart = false; task.wait(1.5) end
            
            -- Sell Logic
            if SellItemRemote then
                 for _, item in pairs(Player.Backpack:GetChildren()) do
                    if item:IsA("Tool") and item.Name ~= "Rod" then
                        pcall(function() SellItemRemote:InvokeServer(item) end)
                    end
                end
            end
            
            if wasFish then task.wait(1); getgenv().fishingStart = true; task.spawn(startFishingHyperLoop) end
            _G.SellSettings.NextSellTime = os.time() + _G.SellSettings.Interval
        end
    end
end)

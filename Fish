-- FISH IT ULTIMATE V3 (LIGHTWEIGHT & MINIMIZABLE)
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local _G = {AutoFish = false, AutoSell = false, Booster = false, BaitDelay = 1.0, ReelDelay = 0.5}

-- 1. CORE LOGIC (FISH & SELL)
task.spawn(function()
    while task.wait(0.5) do
        if _G.AutoFish then
            local tool = player.Character:FindFirstChildOfClass("Tool")
            if tool and tool:FindFirstChild("Click") then
                tool.Click:FireServer(Vector3.new(0,0,0))
                task.wait(_G.BaitDelay)
                tool.Click:FireServer(Vector3.new(0,0,0))
                task.wait(_G.ReelDelay)
            end
        end
        if _G.AutoSell then
            -- Remote Event Umum untuk Fish It (Menjual semua isi tas)
            local sellRemote = ReplicatedStorage:FindFirstChild("SellAll", true) or ReplicatedStorage:FindFirstChild("Sell", true)
            if sellRemote then sellRemote:FireServer() end
        end
    end
end)

-- 2. MODERN UI CONSTRUCTION
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GeminiV3"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 220, 0, 280)
main.Position = UDim2.new(0.1, 0, 0.3, 0)
main.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
main.BorderSizePixel = 0
main.Parent = screenGui
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 15)

-- Minimize Button
local miniBtn = Instance.new("TextButton")
miniBtn.Size = UDim2.new(0, 30, 0, 30)
miniBtn.Position = UDim2.new(1, -35, 0, 5)
miniBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
miniBtn.Text = "-"
miniBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
miniBtn.Parent = main
Instance.new("UICorner", miniBtn)

-- Content Frame (untuk menyembunyikan isi saat minimize)
local content = Instance.new("Frame")
content.Size = UDim2.new(1, 0, 1, 0)
content.BackgroundTransparency = 1
content.Parent = main

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "FISH IT V3"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.BackgroundTransparency = 1
title.Parent = content

local stats = Instance.new("TextLabel")
stats.Size = UDim2.new(1, 0, 0, 20)
stats.Position = UDim2.new(0, 0, 0, 35)
stats.TextColor3 = Color3.fromRGB(0, 255, 150)
stats.Font = Enum.Font.Code
stats.BackgroundTransparency = 1
stats.Parent = content

-- Helper: Create Modern Button
local function createBtn(text, pos, color, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 180, 0, 35)
    btn.Position = pos
    btn.BackgroundColor3 = color
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamMedium
    btn.Parent = content
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

local bBtn = createBtn("BOOSTER: OFF", UDim2.new(0, 20, 0, 70), Color3.fromRGB(45, 45, 50), function()
    _G.Booster = not _G.Booster
    Lighting.GlobalShadows = not _G.Booster
    settings().Rendering.QualityLevel = _G.Booster and 1 or 0
end)

local fBtn = createBtn("AUTO FISH: OFF", UDim2.new(0, 20, 0, 115), Color3.fromRGB(45, 45, 50), function()
    _G.AutoFish = not _G.AutoFish
end)

local sBtn = createBtn("AUTO SELL: OFF", UDim2.new(0, 20, 0, 160), Color3.fromRGB(45, 45, 50), function()
    _G.AutoSell = not _G.AutoSell
end)

-- Delay Inputs
local delayBox = Instance.new("TextBox")
delayBox.Size = UDim2.new(0, 180, 0, 30)
delayBox.Position = UDim2.new(0, 20, 0, 210)
delayBox.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
delayBox.PlaceholderText = "Bait Delay (Sec)"
delayBox.Text = "1.0"
delayBox.TextColor3 = Color3.fromRGB(255, 255, 0)
delayBox.Parent = content
Instance.new("UICorner", delayBox)

-- 3. ANIMATION & SYSTEM LOGIC
local isMini = false
miniBtn.MouseButton1Click:Connect(function()
    isMini = not isMini
    if isMini then
        content.Visible = false
        main:TweenSize(UDim2.new(0, 40, 0, 40), "Out", "Quad", 0.3, true)
        miniBtn.Text = "+"
        miniBtn.Position = UDim2.new(0, 5, 0, 5)
    else
        main:TweenSize(UDim2.new(0, 220, 0, 280), "Out", "Quad", 0.3, true)
        task.wait(0.3)
        content.Visible = true
        miniBtn.Text = "-"
        miniBtn.Position = UDim2.new(1, -35, 0, 5)
    end
end)

-- Stats & Button Colors Update
RunService.RenderStepped:Connect(function(dt)
    stats.Text = string.format("FPS: %d | Ping: %dms", math.floor(1/dt), math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue()))
    bBtn.Text = _G.Booster and "BOOSTER: ON" or "BOOSTER: OFF"
    bBtn.BackgroundColor3 = _G.Booster and Color3.fromRGB(0, 150, 80) or Color3.fromRGB(45, 45, 50)
    fBtn.Text = _G.AutoFish and "AUTO FISH: ON" or "AUTO FISH: OFF"
    fBtn.BackgroundColor3 = _G.AutoFish and Color3.fromRGB(0, 120, 200) or Color3.fromRGB(45, 45, 50)
    sBtn.Text = _G.AutoSell and "AUTO SELL: ON" or "AUTO SELL: OFF"
    sBtn.BackgroundColor3 = _G.AutoSell and Color3.fromRGB(200, 100, 0) or Color3.fromRGB(45, 45, 50)
end)

delayBox.FocusLost:Connect(function() _G.BaitDelay = tonumber(delayBox.Text) or 1.0 end)

-- Draggable UI
local d, i, s, sp; main.InputBegan:Connect(function(inp) if inp.UserInputType == Enum.UserInputType.MouseButton1 then d = true s = inp.Position sp = main.Position end end)
UserInputService.InputChanged:Connect(function(inp) if d and inp.UserInputType == Enum.UserInputType.MouseMovement then local dl = inp.Position - s main.Position = UDim2.new(sp.X.Scale, sp.X.Offset + dl.X, sp.Y.Scale, sp.Y.Offset + dl.Y) end end)
main.InputEnded:Connect(function(inp) if inp.UserInputType == Enum.UserInputType.MouseButton1 then d = false end end)
